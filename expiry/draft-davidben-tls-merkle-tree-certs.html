<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Merkle Tree Certificates for TLS</title>
<meta content="David Benjamin" name="author">
<meta content="Devon O'Brien" name="author">
<meta content="Bas Westerbaan" name="author">
<meta content="
       This document describes Merkle Tree certificates, a new certificate type for use with TLS. A relying party that regularly fetches information from a transparency service can use this certificate type as a size optimization over more conventional mechanisms with post-quantum signatures. Merkle Tree certificates integrate the roles of X.509 and Certificate Transparency, achieving comparable security properties with a smaller message size, at the cost of more limited applicability. 
    " name="description">
<meta content="xml2rfc 3.23.1" name="generator">
<meta content="draft-davidben-tls-merkle-tree-certs-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.23.1
    Python 3.12.6
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.4
    lxml 4.9.4
    platformdirs 4.3.6
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-davidben-tls-merkle-tree-certs.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Merkle Tree Certificates for TLS</td>
<td class="right">September 2024</td>
</tr></thead>
<tfoot><tr>
<td class="left">Benjamin, et al.</td>
<td class="center">Expires 23 March 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Transport Layer Security</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-davidben-tls-merkle-tree-certs-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2024-09-19" class="published">19 September 2024</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-03-23">23 March 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Benjamin</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">D. O'Brien</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">B. E. Westerbaan</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Merkle Tree Certificates for TLS</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes Merkle Tree certificates, a new certificate type for use with TLS. A relying party that regularly fetches information from a transparency service can use this certificate type as a size optimization over more conventional mechanisms with post-quantum signatures. Merkle Tree certificates integrate the roles of X.509 and Certificate Transparency, achieving comparable security properties with a smaller message size, at the cost of more limited applicability.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://davidben.github.io/merkle-tree-certs/draft-davidben-tls-merkle-tree-certs.html">https://davidben.github.io/merkle-tree-certs/draft-davidben-tls-merkle-tree-certs.html</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-davidben-tls-merkle-tree-certs/">https://datatracker.ietf.org/doc/draft-davidben-tls-merkle-tree-certs/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        Transport Layer Security Working Group mailing list (<span><a href="mailto:tls@ietf.org">mailto:tls@ietf.org</a></span>),
        which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/tls/">https://mailarchive.ietf.org/arch/browse/tls/</a></span>.
        Subscribe at <span><a href="https://www.ietf.org/mailman/listinfo/tls/">https://www.ietf.org/mailman/listinfo/tls/</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/davidben/merkle-tree-certs">https://github.com/davidben/merkle-tree-certs</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 23 March 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2024 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-time" class="internal xref">Time</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-terminology-and-roles" class="internal xref">Terminology and Roles</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-assertions" class="internal xref">Assertions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-dns-claims" class="internal xref">DNS Claims</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-ip-claims" class="internal xref">IP Claims</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-issuing-certificates" class="internal xref">Issuing Certificates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-merkle-tree-ca-parameters" class="internal xref">Merkle Tree CA Parameters</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-identifying-cas-and-batches" class="internal xref">Identifying CAs and Batches</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-batch-state" class="internal xref">Batch State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-issuance-queue-and-scheduli" class="internal xref">Issuance Queue and Scheduling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-certifying-a-batch-of-asser" class="internal xref">Certifying a Batch of Assertions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.1">
                    <p id="section-toc.1-1.5.2.5.2.1.1"><a href="#section-5.5.1" class="auto internal xref">5.5.1</a>.  <a href="#name-building-the-merkle-tree" class="internal xref">Building the Merkle Tree</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.2">
                    <p id="section-toc.1-1.5.2.5.2.2.1"><a href="#section-5.5.2" class="auto internal xref">5.5.2</a>.  <a href="#name-signing-a-validitywindow" class="internal xref">Signing a ValidityWindow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.3">
                    <p id="section-toc.1-1.5.2.5.2.3.1"><a href="#section-5.5.3" class="auto internal xref">5.5.3</a>.  <a href="#name-certificate-format" class="internal xref">Certificate Format</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-size-estimates" class="internal xref">Size Estimates</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-using-certificates" class="internal xref">Using Certificates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-relying-party-state" class="internal xref">Relying Party State</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-certificate-verification" class="internal xref">Certificate Verification</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-transparency-services" class="internal xref">Transparency Services</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-single-trusted-service" class="internal xref">Single Trusted Service</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-single-update-service-with-" class="internal xref">Single Update Service with Multiple Mirrors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-multiple-transparency-servi" class="internal xref">Multiple Transparency Services</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-monitors" class="internal xref">Monitors</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-http-interface" class="internal xref">HTTP Interface</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-acme-extensions" class="internal xref">ACME Extensions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-use-in-tls" class="internal xref">Use in TLS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-tls-subjects" class="internal xref">TLS Subjects</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-the-bikeshed-certificate-ty" class="internal xref">The Bikeshed Certificate Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="auto internal xref">10.3</a>.  <a href="#name-certificate-negotiation" class="internal xref">Certificate Negotiation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-deployment-considerations" class="internal xref">Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-fallback-mechanisms" class="internal xref">Fallback Mechanisms</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-rolling-renewal" class="internal xref">Rolling Renewal</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="auto internal xref">11.3</a>.  <a href="#name-deploying-new-keys" class="internal xref">Deploying New Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-11.4" class="auto internal xref">11.4</a>.  <a href="#name-batch-state-availability" class="internal xref">Batch State Availability</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-authenticity" class="internal xref">Authenticity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="auto internal xref">13.2</a>.  <a href="#name-cross-protocol-attacks" class="internal xref">Cross-protocol attacks</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-13.3" class="auto internal xref">13.3</a>.  <a href="#name-revocation" class="internal xref">Revocation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#section-13.4" class="auto internal xref">13.4</a>.  <a href="#name-transparency" class="internal xref">Transparency</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4.2.1">
                    <p id="section-toc.1-1.13.2.4.2.1.1"><a href="#section-13.4.1" class="auto internal xref">13.4.1</a>.  <a href="#name-unauthorized-certificates" class="internal xref">Unauthorized Certificates</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4.2.2">
                    <p id="section-toc.1-1.13.2.4.2.2.1"><a href="#section-13.4.2" class="auto internal xref">13.4.2</a>.  <a href="#name-misbehaving-certification-a" class="internal xref">Misbehaving Certification Authority</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.4.2.3">
                    <p id="section-toc.1-1.13.2.4.2.3.1"><a href="#section-13.4.3" class="auto internal xref">13.4.3</a>.  <a href="#name-misbehaving-transparency-se" class="internal xref">Misbehaving Transparency Service</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#section-13.5" class="auto internal xref">13.5</a>.  <a href="#name-security-of-fallback-mechan" class="internal xref">Security of Fallback Mechanisms</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="auto internal xref">15.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="auto internal xref">15.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-abridgedassertions" class="internal xref">(Abridged)Assertions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-tls-certificate-type-negoti" class="internal xref">TLS Certificate Type Negotiation Challenges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-indicate-in-first-certifica" class="internal xref">Indicate in First CertificateEntry</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.1.2.1">
                    <p id="section-toc.1-1.17.2.1.2.1.1"><a href="#appendix-B.1.1" class="auto internal xref">B.1.1</a>.  <a href="#name-change-certificate-syntax" class="internal xref">Change Certificate Syntax</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-D" class="auto internal xref"></a><a href="#name-change-log" class="internal xref">Change log</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.19.2.1">
                <p id="section-toc.1-1.19.2.1.1"><a href="#appendix-D.1" class="auto internal xref"></a><a href="#name-since-draft-davidben-tls-me" class="internal xref">Since draft-davidben-tls-merkle-tree-certs-00</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-E" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Authors' Note: This is an early draft of a proposal with many parts. While we have tried to make it as concrete as possible, we anticipate that most details will change as the proposal evolves.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">A typical TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> handshake uses many signatures to authenticate the server public key. In a certificate chain with an end-entity certificate, an intermediate certificate, and an implicit trust anchor, there are two X.509 signatures <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>. Intermediate certificates additionally send an extra public key. If the handshake uses Certificate Transparency (CT) <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span>, each Signed Certificate Timestamp (SCT) also carries a signature. CT policies often require two or more SCTs per certificate <span>[<a href="#APPLE-CT" class="cite xref">APPLE-CT</a>]</span> <span>[<a href="#CHROME-CT" class="cite xref">CHROME-CT</a>]</span>. If the handshake staples an OCSP response <span>[<a href="#RFC6066" class="cite xref">RFC6066</a>]</span> for revocation, that adds an additional signature.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Current signature schemes can use as few as 32 bytes per key and 64 bytes per signature <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>, but post-quantum replacements are much larger. For example, Dilithium3 <span>[<a href="#Dilithium" class="cite xref">Dilithium</a>]</span> uses 1,952 bytes per public key and 3,293 bytes per signature. A TLS Certificate message with, say, four Dilithum3 signatures (two X.509 signatures and two SCTs) and one intermediate CA's Dilithium3 public key would total 15,124 bytes of authentication overhead. Falcon-512 and Falcon-1024 <span>[<a href="#Falcon" class="cite xref">Falcon</a>]</span> would, respectively, total 3,561 and 6,913 bytes.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document introduces Merkle Tree Certificates, an optimization that authenticates a subscriber key using under 1,000 bytes. See <a href="#sizes" class="auto internal xref">Section 5.6</a>. To achieve this, it reduces its scope from general authentication:<a href="#section-1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-5.1">
          <p id="section-1-5.1.1">Certificates are short-lived. The subscriber is expected to use an automated issuance protocol, such as ACME <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span>.<a href="#section-1-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.2">
          <p id="section-1-5.2.1">Certificates are only usable with relying parties that have contacted a transparency service sufficiently recently. See <a href="#transparency-service" class="auto internal xref">Section 7</a>.<a href="#section-1-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-5.3">
          <p id="section-1-5.3.1">Certificates are issued after a significant processing delay of, in the recommended parameters (<a href="#parameters" class="auto internal xref">Section 5.1</a>), about an hour. Subscribers that need a certificate issued quickly are expected to use a different mechanism.<a href="#section-1-5.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-6">To support the reduced scope, this document also describes a certificate negotiation mechanism. Subscribers send these more efficient certificates when available, and otherwise fall back to other mechanisms.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">Merkle Tree Certificates are not intended to replace existing Public Key Infrastructure (PKI) mechanisms but, in applications where a significant portion of authentications meet the above requirements, complement them as an optional optimization. In particular, it is expected that, even within applications that implement it, this mechanism will not be usable for all TLS connections.<a href="#section-1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span>
when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This document additionally uses the TLS presentation language defined in <span><a href="https://rfc-editor.org/rfc/rfc8446#section-3" class="relref">Section 3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="time">
<section id="section-2.1">
        <h3 id="name-time">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-time" class="section-name selfRef">Time</a>
        </h3>
<p id="section-2.1-1">All time computations in this document are represented by POSIX timestamps, defined in this document to be integers containing a number of seconds since the Epoch, defined in Section 4.16 of <span>[<a href="#POSIX" class="cite xref">POSIX</a>]</span>. That is, the number of seconds after 1970-01-01 00:00:00 UTC, excluding leap seconds. A UTC time is converted to a POSIX timestamp as described in <span>[<a href="#POSIX" class="cite xref">POSIX</a>]</span>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Durations of time are integers, representing a number of seconds not including leap seconds. They can be added to POSIX timestamps to produce other POSIX timestamps.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">The current time is a POSIX timestamp determined by converting the current UTC time to seconds since the Epoch. One POSIX timestamp is said to be before (respectively, after) another POSIX timestamp if it is less than (respectively, greater than) the other value.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology-and-roles">
<section id="section-2.2">
        <h3 id="name-terminology-and-roles">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-terminology-and-roles" class="section-name selfRef">Terminology and Roles</a>
        </h3>
<p id="section-2.2-1">There are five roles involved in a Merkle Tree certificate deployment:<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.2-2">
          <dt id="section-2.2-2.1">Subscriber:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.2">
            <p id="section-2.2-2.2.1">The party that authenticates itself in the protocol. In TLS, this is the side sending the Certificate and CertificateVerify message.<a href="#section-2.2-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.3">Merkle Tree certification authority (CA):</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.4">
            <p id="section-2.2-2.4.1">The service that issues Merkle Tree certificates to the subscriber, and publishes logs of all certificates.<a href="#section-2.2-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.5">Relying party:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.6">
            <p id="section-2.2-2.6.1">The party authenticating the subscriber. In TLS, this is the side receiving the Certificate and CertificateVerify message.<a href="#section-2.2-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.7">Transparency service:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.8">
            <p id="section-2.2-2.8.1">The service that mirrors the issued certificates for others to monitor. It additionally summarizes the CA's activity for relying parties, in order for certificates to be accepted. This is conceptually a single service, but may be multiple services, run by multiple entities in concert. See <a href="#transparency-service" class="auto internal xref">Section 7</a>. For example, if the relying party is a web browser, the browser vendor might run the transparency service, or it may trust a collection of third-party mirrors.<a href="#section-2.2-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-2.9">Monitors:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-2.10">
            <p id="section-2.2-2.10.1">Parties who monitor the list of valid certificates, published by the transparency service, for unauthorized certificates.<a href="#section-2.2-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.2-3">Additionally, there are several terms used throughout this document to describe this proposal. This section provides an overview. They will be further defined and discussed in detail throughout the document.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.2-4">
          <dt id="section-2.2-4.1">Assertion:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.2">
            <p id="section-2.2-4.2.1">A protocol-specific statement that the CA is certifying. For example, in TLS, the assertion is that a TLS signing key can speak on behalf of some DNS name or other identity.<a href="#section-2.2-4.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.3">Abridged assertion:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.4">
            <p id="section-2.2-4.4.1">A partially-hashed Assertion to save space. For example, in TLS, an abridged assertion replaces the subject public key by a hash.<a href="#section-2.2-4.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.5">Certificate:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.6">
            <p id="section-2.2-4.6.1">A structure, generated by the CA, that proves to the relying party that the CA has certified some assertion. A certificate consists of the assertion itself accompanied by an associated proof string.<a href="#section-2.2-4.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.7">Batch:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.8">
            <p id="section-2.2-4.8.1">A collection of assertions certified at the same time. CAs in this proposal only issue certificates in batches at a fixed frequency.<a href="#section-2.2-4.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.9">Batch tree head:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.10">
            <p id="section-2.2-4.10.1">A hash computed over all the assertions in a batch, by building a Merkle Tree. The Merkle Tree construction and this hash are described in more detail in <a href="#building-tree" class="auto internal xref">Section 5.5.1</a>.<a href="#section-2.2-4.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.11">Inclusion proof:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.12">
            <p id="section-2.2-4.12.1">A structure which proves that some assertion is contained in some tree head. See <a href="#proofs" class="auto internal xref">Section 5.5.3</a>.<a href="#section-2.2-4.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.2-4.13">Validity window:</dt>
          <dd style="margin-left: 1.5em" id="section-2.2-4.14">
            <p id="section-2.2-4.14.1">A range of consecutive batch tree heads. A relying party maintains a copy of the CA's latest validity window. At any time, it will accept only assertions contained in tree heads contained in the current validity window.<a href="#section-2.2-4.14.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-3-1">The process of issuing and using a certificate is as follows:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">The subscriber requests a certificate from the CA. <a href="#acme-extensions" class="auto internal xref">Section 9</a> describes ACME <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span> extensions for this.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">The CA collects certificate requests into a batch (see <a href="#parameters" class="auto internal xref">Section 5.1</a>) and builds the Merkle Tree and computes the tree head (see <a href="#building-tree" class="auto internal xref">Section 5.5.1</a>). It then signs the validity window ending at this tree head (see <a href="#signing" class="auto internal xref">Section 5.5.2</a>) and publishes (see <a href="#publishing" class="auto internal xref">Section 8</a>) the result.<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">The CA constructs a certificate using the inclusion proof. It sends this certificate to the subscriber. See <a href="#proofs" class="auto internal xref">Section 5.5.3</a>.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.4">
          <p id="section-3-2.4.1">The transparency service downloads the abridged assertions, recreates the Merkle Tree, and validates the window signature. It mirrors them for monitors to observe. See <a href="#transparency-service" class="auto internal xref">Section 7</a>.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.5">
          <p id="section-3-2.5.1">The relying party fetches the latest validity window from the transparency service. This validity window will contain the new tree head.<a href="#section-3-2.5.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.6">
          <p id="section-3-2.6.1">In an application protocol such as TLS, the relying party communicates its currently saved validity window to the subscriber.<a href="#section-3-2.6.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.7">
          <p id="section-3-2.7.1">If the relying party’s validity window contains the subscriber’s certificate, the subscriber negotiates this protocol and sends the Merkle Tree certificate. See <a href="#certificate-negotiation" class="auto internal xref">Section 10.3</a> for details. If there is no match, the subscriber proceeds as if this protocol were not in use (e.g., by sending a traditional X.509 certificate chain).<a href="#section-3-2.7.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-3-3"><a href="#fig-deployment" class="auto internal xref">Figure 1</a> below shows this process.<a href="#section-3-3" class="pilcrow">¶</a></p>
<span id="name-an-overview-of-a-merkle-tre"></span><div id="fig-deployment">
<figure id="figure-1">
        <div id="section-3-4.1">
          <div class="alignLeft art-svg artwork" id="section-3-4.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="400" width="584" viewBox="0 0 584 400" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 40,192 L 40,256" fill="none" stroke="black"></path>
              <path d="M 48,32 L 48,96" fill="none" stroke="black"></path>
              <path d="M 104,104 L 104,192" fill="none" stroke="black"></path>
              <path d="M 128,96 L 128,184" fill="none" stroke="black"></path>
              <path d="M 168,32 L 168,96" fill="none" stroke="black"></path>
              <path d="M 184,192 L 184,256" fill="none" stroke="black"></path>
              <path d="M 360,32 L 360,96" fill="none" stroke="black"></path>
              <path d="M 368,192 L 368,256" fill="none" stroke="black"></path>
              <path d="M 408,320 L 408,384" fill="none" stroke="black"></path>
              <path d="M 456,96 L 456,184" fill="none" stroke="black"></path>
              <path d="M 456,256 L 456,312" fill="none" stroke="black"></path>
              <path d="M 512,320 L 512,384" fill="none" stroke="black"></path>
              <path d="M 552,192 L 552,256" fill="none" stroke="black"></path>
              <path d="M 568,32 L 568,96" fill="none" stroke="black"></path>
              <path d="M 48,32 L 168,32" fill="none" stroke="black"></path>
              <path d="M 360,32 L 568,32" fill="none" stroke="black"></path>
              <path d="M 168,48 L 352,48" fill="none" stroke="black"></path>
              <path d="M 176,80 L 360,80" fill="none" stroke="black"></path>
              <path d="M 48,96 L 168,96" fill="none" stroke="black"></path>
              <path d="M 360,96 L 568,96" fill="none" stroke="black"></path>
              <path d="M 40,192 L 184,192" fill="none" stroke="black"></path>
              <path d="M 368,192 L 552,192" fill="none" stroke="black"></path>
              <path d="M 192,224 L 368,224" fill="none" stroke="black"></path>
              <path d="M 40,256 L 184,256" fill="none" stroke="black"></path>
              <path d="M 368,256 L 552,256" fill="none" stroke="black"></path>
              <path d="M 408,320 L 512,320" fill="none" stroke="black"></path>
              <path d="M 408,384 L 512,384" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="464,312 452,306.4 452,317.6" fill="black" transform="rotate(90,456,312)"></polygon>
              <polygon class="arrowhead" points="464,184 452,178.4 452,189.6" fill="black" transform="rotate(90,456,184)"></polygon>
              <polygon class="arrowhead" points="360,48 348,42.4 348,53.6" fill="black" transform="rotate(0,352,48)"></polygon>
              <polygon class="arrowhead" points="200,224 188,218.4 188,229.6" fill="black" transform="rotate(180,192,224)"></polygon>
              <polygon class="arrowhead" points="184,80 172,74.4 172,85.6" fill="black" transform="rotate(180,176,80)"></polygon>
              <polygon class="arrowhead" points="136,184 124,178.4 124,189.6" fill="black" transform="rotate(90,128,184)"></polygon>
              <polygon class="arrowhead" points="112,104 100,98.4 100,109.6" fill="black" transform="rotate(270,104,104)"></polygon>
              <g class="text">
                <text x="196" y="36">1.</text>
                <text x="244" y="36">issuance</text>
                <text x="312" y="36">request</text>
                <text x="108" y="68">Subscriber</text>
                <text x="424" y="68">Certification</text>
                <text x="520" y="68">Authority</text>
                <text x="204" y="100">3.</text>
                <text x="256" y="100">inclusion</text>
                <text x="320" y="100">proof</text>
                <text x="476" y="132">2.</text>
                <text x="508" y="132">sign</text>
                <text x="544" y="132">and</text>
                <text x="12" y="148">6.</text>
                <text x="60" y="148">accepted</text>
                <text x="148" y="148">7.</text>
                <text x="200" y="148">inclusion</text>
                <text x="264" y="148">proof</text>
                <text x="504" y="148">publish</text>
                <text x="556" y="148">tree</text>
                <text x="28" y="164">tree</text>
                <text x="72" y="164">heads</text>
                <text x="212" y="212">5.</text>
                <text x="248" y="212">batch</text>
                <text x="292" y="212">tree</text>
                <text x="336" y="212">heads</text>
                <text x="88" y="228">Relying</text>
                <text x="144" y="228">Party</text>
                <text x="428" y="228">Transparency</text>
                <text x="512" y="228">Service</text>
                <text x="476" y="292">4.</text>
                <text x="516" y="292">mirror</text>
                <text x="564" y="292">tree</text>
                <text x="460" y="356">Monitors</text>
              </g>
            </svg><a href="#section-3-4.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-an-overview-of-a-merkle-tre" class="selfRef">An overview of a Merkle Tree certificate deployment</a>
        </figcaption></figure>
</div>
<p id="section-3-5">The remainder of this document discusses this process in detail, followed by concrete instantions of it in TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> and ACME <span>[<a href="#RFC8555" class="cite xref">RFC8555</a>]</span>.<a href="#section-3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="assertions">
<section id="section-4">
      <h2 id="name-assertions">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-assertions" class="section-name selfRef">Assertions</a>
      </h2>
<p id="section-4-1">[[TODO: The protocol described in this document is broadly independent of the assertion format. We describe, below, one possible structure, but welcome feedback on how best to structure the encoding. The main aims are simplicity and to improve on handling cross-protocol attacks per <a href="#cross-protocol" class="auto internal xref">Section 13.2</a>.]]<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">TLS certificates associate some application-specific identifier with a TLS signing key. When TLS is used to authenticate HTTPS <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span> servers, these identifiers specify DNS names or HTTP origins. Other protocols may require other kinds of assertions.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">To represent this, this document defines an Assertion structure:<a href="#section-4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-4">
<pre>
enum { tls(0), (2^16-1) } SubjectType;

enum {
    dns(0),
    dns_wildcard(1),
    ipv4(2),
    ipv6(3),
    (2^16-1)
} ClaimType;

struct {
    ClaimType claim_type;
    opaque claim_info&lt;0..2^16-1&gt;;
} Claim;

struct {
    SubjectType subject_type;
    opaque subject_info&lt;0..2^16-1&gt;;
    Claim claims&lt;0..2^16-1&gt;;
} Assertion;
</pre><a href="#section-4-4" class="pilcrow">¶</a>
</div>
<p id="section-4-5">An Assertion is roughly analogous to an X.509 TBSCertificate (<span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.1.2" class="relref">Section 4.1.2</a> of [<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>). It describes a series of claims about some subject. The <code>subject_info</code> field is interpreted according to the <code>subject_type</code> value. For TLS, the <code>subject_type</code> is <code>tls</code>, and the <code>subject_info</code> is a TLSSubjectInfo structure. TLSSubjectInfo is defined in full in <a href="#tls-subject-info" class="auto internal xref">Section 10.1</a> below, but as an illustrative example, it is reproduced below:<a href="#section-4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-6">
<pre>
struct {
    SignatureScheme signature;
    opaque public_key&lt;1..2^16-1&gt;;
} TLSSubjectInfo;
</pre><a href="#section-4-6" class="pilcrow">¶</a>
</div>
<p id="section-4-7">This structure represents the public half of a TLS signing key. The semantics are thus that each claim in <code>claims</code> applies to the TLS client or server. This is analogous to X.509's SubjectPublicKeyInfo structure (<span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.1.2.7" class="relref">Section 4.1.2.7</a> of [<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>) but additionally incorporates the protocol. Protocols consuming an Assertion MUST check the <code>subject_type</code> is a supported value before processing <code>subject_info</code>. If unrecognized, the structure MUST be rejected.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">Other protocols aiming to integrate with this structure allocate a SubjectType codepoint and describe how it is interpreted.<a href="#section-4-8" class="pilcrow">¶</a></p>
<p id="section-4-9">Likewise, a Claim structure describes some claim about the subject. The <code>claim_info</code> field is interpreted according to the <code>claim_type</code>. Each Claim structure in an Assertion's <code>claims</code> field MUST have a unique <code>claim_type</code> and all values MUST be sorted in order of increasing <code>claim_type</code>. Structures violating this constraint MUST be rejected.<a href="#section-4-9" class="pilcrow">¶</a></p>
<p id="section-4-10">When a relying party interprets an Assertion certified by the CA, it MUST ignore any Claim values with unrecognized <code>claim_type</code>. When a CA interprets an Assertion in a certification request from a subscriber, it MUST reject any Claim values with unrecognized <code>claim_type</code>.<a href="#section-4-10" class="pilcrow">¶</a></p>
<p id="section-4-11">This document defines claim types for DNS names and IP addresses, but others can be defined.<a href="#section-4-11" class="pilcrow">¶</a></p>
<p id="section-4-12">[[TODO: For now, the claims below just transcribe the X.509 GeneralName structure. Should these be origins instead? For HTTPS, it's a pity to not capture the scheme and port. We do mandate ALPN in <a href="#tls-certificate-type" class="auto internal xref">Section 10.2</a>, so cross-protocol attacks are mitigated, but it's unfortunate that subscribers cannot properly separate their HTTPS vs FTPS keys, or their port 443 vs port 444 keys. One option here is to have HTTPS claims instead, and then other protocols can have FTPS claims, etc. #35 ]]<a href="#section-4-12" class="pilcrow">¶</a></p>
<div id="dns-claims">
<section id="section-4.1">
        <h3 id="name-dns-claims">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-dns-claims" class="section-name selfRef">DNS Claims</a>
        </h3>
<p id="section-4.1-1">The <code>dns</code> and <code>dns_wildcard</code> claims indicate that the subject is authoritative for a set of DNS names. They use the DNSNameList structure, defined below:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-2">
<pre>
opaque DNSName&lt;1..255&gt;;

struct {
    DNSName dns_names&lt;1..2^16-1&gt;;
} DNSNameList;
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">DNSName values use the "preferred name syntax" as specified by <span><a href="https://rfc-editor.org/rfc/rfc1034#section-3.5" class="relref">Section 3.5</a> of [<a href="#RFC1034" class="cite xref">RFC1034</a>]</span> and as modified by <span><a href="https://rfc-editor.org/rfc/rfc1123#section-2.1" class="relref">Section 2.1</a> of [<a href="#RFC1123" class="cite xref">RFC1123</a>]</span>. Alphabetic characters MUST additionally be represented in lowercase. IDNA names <span>[<a href="#RFC5890" class="cite xref">RFC5890</a>]</span> are represented as A-labels. For example, possible values include <code>example.com</code> or <code>xn--iv8h.example</code>. Values <code>EXAMPLE.COM</code> and <code>&lt;U+1F50F&gt;.example</code> would not be permitted.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Names in a <code>dns</code> claim represent the exact DNS name specified. Names in a <code>dns_wildcard</code> claim represent wildcard DNS names and are processed as if prepended with the string "<code>*.</code>" and then following the steps in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-uta-rfc6125bis-15#section-6.3" class="relref">Section 6.3</a> of [<a href="#I-D.draft-ietf-uta-rfc6125bis" class="cite xref">I-D.draft-ietf-uta-rfc6125bis</a>]</span>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ip-claims">
<section id="section-4.2">
        <h3 id="name-ip-claims">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-ip-claims" class="section-name selfRef">IP Claims</a>
        </h3>
<p id="section-4.2-1">The <code>ipv4</code> and <code>ipv6</code> claims indicate the subject is authoritative for a set of IPv4 and IPv6 addresses, respectively. They use the IPv4AddressList and IPv6AddressList structures, respectively, defined below. IPv4Address and IPv6Address are interpreted in network byte order.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-2">
<pre>
uint8 IPv4Address[4];
uint8 IPv6Address[16];

struct {
    IPv4Address addresses&lt;4..2^16-1&gt;;
} IPv4AddressList;

struct {
    IPv6Address addresses&lt;16..2^16-1&gt;;
} IPv6AddressList;
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="issuing-certificates">
<section id="section-5">
      <h2 id="name-issuing-certificates">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-issuing-certificates" class="section-name selfRef">Issuing Certificates</a>
      </h2>
<p id="section-5-1">This section describes the structure of Merkle Tree certificates and defines the process of how a Merkle Tree certification authority issues certificates for a subscriber.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="parameters">
<section id="section-5.1">
        <h3 id="name-merkle-tree-ca-parameters">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-merkle-tree-ca-parameters" class="section-name selfRef">Merkle Tree CA Parameters</a>
        </h3>
<p id="section-5.1-1">A Merkle Tree certification authority is defined by the following values:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.1-2">
          <dt id="section-5.1-2.1">
<code>hash</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.2">
            <p id="section-5.1-2.2.1">A cryptographic hash function. In this document, the hash function is always SHA-256 <span>[<a href="#SHS" class="cite xref">SHS</a>]</span>, but others may be defined.<a href="#section-5.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.3">
<code>issuer_id</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.4">
            <p id="section-5.1-2.4.1">A trust anchor identifier (see <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-3" class="relref">Section 3</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>) that identifies the CA. See <a href="#identifying" class="auto internal xref">Section 5.2</a> for details.<a href="#section-5.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.5">
<code>public_key</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.6">
            <p id="section-5.1-2.6.1">The public half of a signing keypair. The corresponding private key, <code>private_key</code>, is known only to the CA.<a href="#section-5.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.7">
<code>start_time</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.8">
            <p id="section-5.1-2.8.1">The issuance time of the first batch of certificates, represented as a POSIX timestamp (see <a href="#time" class="auto internal xref">Section 2.1</a>).<a href="#section-5.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.9">
<code>batch_duration</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.10">
            <p id="section-5.1-2.10.1">A number of seconds which determines how frequently the CA issues certificates. See details below.<a href="#section-5.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.11">
<code>lifetime</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.12">
            <p id="section-5.1-2.12.1">A number of seconds which determines the lifetime of certificates issued by this CA. MUST be a multiple of <code>batch_duration</code>.<a href="#section-5.1-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.13">
<code>validity_window_size</code>:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.14">
            <p id="section-5.1-2.14.1">An integer describing the maximum number of unexpired batches which may exist at a time. This value is determined from <code>lifetime</code> and <code>batch_duration</code> by <code>lifetime / batch_duration</code>.<a href="#section-5.1-2.14.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.1-3">These values are public and known by the relying party and the CA. They may not be changed for the lifetime of the CA. To change these parameters, the entity operating a CA may deploy a second CA and either operate both during a transition, or stop issuing from the previous CA.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">[[TODO: The signing key case is interesting. A CA could actually maintain a single stream of Merkle Trees, but then sign everything with multiple keys to support rotation. The CA -&gt; Subscriber -&gt; RP flow does not depend on the signature, only the CA -&gt; Transparency Service -&gt; RP flow. The document is not currently arranged to capture this, but it probably should be. We probably need to decouple the signing half and the Merkle Tree half slightly. #36 ]]<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">Certificates are issued in batches. Batches are numbered consecutively, starting from zero. All certificates in a batch have the same issuance time, determined by <code>start_time + batch_duration * batch_number</code>. This is known as the batch's issuance time. That is, batch 0 has an issuance time of <code>start_time</code>, and issuance times increment by <code>batch_duration</code>. A CA can issue no more frequently than <code>batch_duration</code>. <code>batch_duration</code> determines how long it takes for the CA to return a certificate to the subscriber.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">All certificates in a batch have the same expiration time, computed as <code>lifetime</code> past the issuance time. After this time, the certificates in a batch are no longer valid. Merkle Tree certificates uses a short-lived certificates model, such that certificate expiration replaces an external revocation signal like CRLs <span>[<a href="#RFC5280" class="cite xref">RFC5280</a>]</span> or OCSP <span>[<a href="#RFC6960" class="cite xref">RFC6960</a>]</span>. <code>lifetime</code> SHOULD be set accordingly. For instance, a deployment with a corresponding maximum OCSP <span>[<a href="#RFC6960" class="cite xref">RFC6960</a>]</span> response lifetime of 14 days SHOULD use a value no higher than 14 days. See <a href="#revocation" class="auto internal xref">Section 13.3</a> for details.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">CAs are RECOMMENDED to use a <code>batch_duration</code> of one hour, and a <code>lifetime</code> of 14 days. This results in a <code>validity_window_size</code> of 336, for a total of 10,752 bytes in SHA-256 hashes.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">To prevent cross-protocol attacks, the key used in a Merkle Tree CA MUST be unique to that Merkle Tree CA. It MUST NOT be used in another Merkle Tree CA, or for another protocol, such as X.509 certificates.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="identifying">
<section id="section-5.2">
        <h3 id="name-identifying-cas-and-batches">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-identifying-cas-and-batches" class="section-name selfRef">Identifying CAs and Batches</a>
        </h3>
<p id="section-5.2-1">A Merkle Tree CA's <code>issuer_id</code> is a trust anchor identifier, defined in <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-3" class="relref">Section 3</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>. However, unlike an X.509 CA, the entire OID arc rooted at the identifier is associated with the CA. OIDs under this arc are used to identify batches below.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">An individual batch from a Merkle Tree CA also has an associated trust anchor identifier, called a <code>batch_id</code>. It is determined by appending the batch number, as an OID component, to the CA's <code>issuer_id</code>.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">For example, a Merkle Tree CA may have an <code>issuer_id</code> of <code>32473.1</code>, in the ASCII representation.
The batch with batch number 42 would then have a <code>batch_id</code> of <code>32473.1.42</code>.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batches">
<section id="section-5.3">
        <h3 id="name-batch-state">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-batch-state" class="section-name selfRef">Batch State</a>
        </h3>
<p id="section-5.3-1">Each batch is in one of three states:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.3-2">
          <dt id="section-5.3-2.1">pending:</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-2.2">
            <p id="section-5.3-2.2.1">The current time is before the batch's issuance time<a href="#section-5.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.3">ready:</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-2.4">
            <p id="section-5.3-2.4.1">The current time is not before the batch's issuance time, but the batch has not yet been issued<a href="#section-5.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.5">issued:</dt>
          <dd style="margin-left: 1.5em" id="section-5.3-2.6">
            <p id="section-5.3-2.6.1">Certificates have been issued for this batch<a href="#section-5.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.3-3">The CA also maintains a latest batch number, which is the number of the last batch in the "issued" state. As an invariant, all batches before this value MUST also be in the "issued" state.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">For each batch in the "issued" state, the CA maintains the following batch state:<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-5.1">
            <p id="section-5.3-5.1.1">The list of abridged assertions certified in this batch.<a href="#section-5.3-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-5.2">
            <p id="section-5.3-5.2.1">The tree head, a hash computed over this list, described in <a href="#building-tree" class="auto internal xref">Section 5.5.1</a>.<a href="#section-5.3-5.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.3-5.3">
            <p id="section-5.3-5.3.1">A validity window signature computed as described in <a href="#signing" class="auto internal xref">Section 5.5.2</a>.<a href="#section-5.3-5.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.3-6">The CA exposes all of this information in an HTTP <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span> interface described in <a href="#publishing" class="auto internal xref">Section 8</a>.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance-queue-and-scheduling">
<section id="section-5.4">
        <h3 id="name-issuance-queue-and-scheduli">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-issuance-queue-and-scheduli" class="section-name selfRef">Issuance Queue and Scheduling</a>
        </h3>
<p id="section-5.4-1">The CA additionally maintains an issuance queue, not exposed via the HTTP interface. Each element of the issuance queue is an assertion to be certified, and an optional requested expiration time. The final <code>not_after</code> will be computed from both this requested time and the expiration time of the whole batch.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">When a subscriber requests a certificate for some assertion, the CA first validates it per its issuance policy. For example, it may perform ACME identifier validation challenges (<span><a href="https://rfc-editor.org/rfc/rfc8555#section-8" class="relref">Section 8</a> of [<a href="#RFC8555" class="cite xref">RFC8555</a>]</span>). Once validation is complete and the CA is willing to certify the assertion, the CA appends it, and the subscriber's requested expiry time, to the issuance queue.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">The CA runs a regularly-scheduled issuance job which converts this queue into certificates. This job runs the following procedure:<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.4-4">
<li id="section-5.4-4.1">
            <p id="section-5.4-4.1.1">If no batches are in the "ready" state, do nothing and abort this procedure. Schedule a new job to run sometime after the earliest "pending" batch's issuance time.<a href="#section-5.4-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.4-4.2">
            <p id="section-5.4-4.2.1">For each batch in the "ready" state other than the latest one, run the procedure in <a href="#certifying-batch" class="auto internal xref">Section 5.5</a> with an empty assertion list, in order of increasing batch number. Batches cannot be skipped.<a href="#section-5.4-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.4-4.3">
            <p id="section-5.4-4.3.1">Empty the issuance queue into an ordered list of assertions. Run the procedure in <a href="#certifying-batch" class="auto internal xref">Section 5.5</a> using this list and the remaining batch in the "ready" state. This batch's issuance time will be at or shortly before the current time.<a href="#section-5.4-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
<div id="certifying-batch">
<section id="section-5.5">
        <h3 id="name-certifying-a-batch-of-asser">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-certifying-a-batch-of-asser" class="section-name selfRef">Certifying a Batch of Assertions</a>
        </h3>
<p id="section-5.5-1">This section describes how to certify a given list of assertions at a given batch number. The batch MUST be in the "ready" state, and all preceding batches MUST be in the "issued" state.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<div id="building-tree">
<section id="section-5.5.1">
          <h4 id="name-building-the-merkle-tree">
<a href="#section-5.5.1" class="section-number selfRef">5.5.1. </a><a href="#name-building-the-merkle-tree" class="section-name selfRef">Building the Merkle Tree</a>
          </h4>
<p id="section-5.5.1-1">First, the CA then builds a Merkle Tree from the list as follows:<a href="#section-5.5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.5.1-2">Let <code>n</code> be the number of input assertions. If <code>n &gt; 0</code>, the CA builds a binary tree with l levels numbered <code>0</code> to <code>l-1</code>, where <code>l</code> is the smallest positive integer such that <code>n &lt;= 2^(l-1)</code>. Each node in the tree contains a hash value. Hashes in the tree are built from the following functions:<a href="#section-5.5.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.1-3">
<pre>
    HashEmpty(level, index) = hash(HashEmptyInput)
    HashNode(left, right, level, index) = hash(HashNodeInput)
    HashAssertion(assertion, not_after, index) = hash(HashAssertionInput)
</pre><a href="#section-5.5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.5.1-4"><code>HashEmpyInput</code>, <code>HashNodeInput</code> and <code>HashAssertionInput</code> are computed by encoding the structures defined below:<a href="#section-5.5.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.1-5">
<pre>
struct {
    uint8 distinguisher = 0;
    TrustAnchorIdentifier batch_id;
    uint64 index;
    uint8 level;
} HashEmptyInput;

struct {
    uint8 distinguisher = 1;
    TrustAnchorIdentifier batch_id;
    uint64 index;
    uint8 level;
    opaque left[hash.length];
    opaque right[hash.length];
} HashNodeInput;

struct {
    SubjectType subject_type;
    opaque subject_info_hash[hash.length];
    Claim claims&lt;0..2^16-1&gt;;
} AbridgedAssertion;

struct {
    uint8 distinguisher = 2;
    TrustAnchorIdentifier batch_id;
    uint64 index;
    AbridgedAssertion abridged_assertion;
    Timestamp not_after;
} HashAssertionInput;
</pre><a href="#section-5.5.1-5" class="pilcrow">¶</a>
</div>
<p id="section-5.5.1-6">The <code>batch_id</code> is set to the batch-specific trust anchor identifier, i.e. the <code>issuer_id</code> with the batch number appended as described in <a href="#identifying" class="auto internal xref">Section 5.2</a>.
<code>HashAssertionInput.abridged_assertion.subject_info_hash</code> is set to <code>hash(assertion.subject_info)</code> from the function input <code>assertion</code>, and the remaining fields of <code>HashAssertionInput.abridged_assertion</code> are taken unmodified from <code>assertion</code>.
The remaining fields, such as <code>index</code>, are set to inputs of the function.<a href="#section-5.5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.5.1-7">Tree levels are computed iteratively as follows:<a href="#section-5.5.1-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.5.1-8">
<li id="section-5.5.1-8.1">
              <p id="section-5.5.1-8.1.1">Let <code>batch_not_after</code> be the expiration time for this batch, as described in <a href="#parameters" class="auto internal xref">Section 5.1</a>.<a href="#section-5.5.1-8.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.1-8.2">
              <p id="section-5.5.1-8.2.1">Initialize an array <code>not_after</code> with <code>n</code> elements. For each For <code>j</code> between <code>0</code> and <code>n-1</code>, inclusive, set <code>not_after[j]</code> to the minimum of <code>batch_not_after</code> and assertion <code>j</code>'s requested expiration time. If assertion <code>j</code> did not request an expiration time, set <code>not_after[j]</code> to <code>batch_not_after</code>. If <code>not_after[j]</code> is before the current time, discard the assertion and decrement <code>n</code>.<a href="#section-5.5.1-8.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.1-8.3">
              <p id="section-5.5.1-8.3.1">Initialize level 0 with <code>n</code> elements. For <code>j</code> between <code>0</code> and <code>n-1</code>, inclusive,
set element <code>j</code> to the output of <code>HashAssertion(assertion[j], not_after[j], j)</code>.<a href="#section-5.5.1-8.3.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.1-8.4">
              <p id="section-5.5.1-8.4.1">For <code>i</code> between <code>1</code> and <code>l-1</code>, inclusive, compute level <code>i</code> from level <code>i-1</code> as
follows:<a href="#section-5.5.1-8.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.1-8.4.2.1">
                  <p id="section-5.5.1-8.4.2.1.1">If level <code>i-1</code> has an odd number of elements <code>j</code>, append <code>HashEmpty(i-1, j)</code> to the level.<a href="#section-5.5.1-8.4.2.1.1" class="pilcrow">¶</a></p>
</li>
                <li class="normal" id="section-5.5.1-8.4.2.2">
                  <p id="section-5.5.1-8.4.2.2.1">Initialize level <code>i</code> with half as many elements as level <code>i-1</code>. For all <code>j</code>,
set element <code>j</code> to the output of <code>HashNode(left, right, i, j)</code> where <code>left</code> is
element <code>2*j</code> of level <code>i-1</code> and <code>right</code> is element <code>2*j+1</code> of level <code>i-1</code>.
<code>left</code> and <code>right</code> are the left and right children of element <code>j</code>.<a href="#section-5.5.1-8.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
          </ol>
<p id="section-5.5.1-9">At the end of this process, level <code>l-1</code> will have exactly one root element. This element is called the tree head. <a href="#fig-example-tree" class="auto internal xref">Figure 2</a> shows an example tree for three assertions. The tree head in this example is t20.<a href="#section-5.5.1-9" class="pilcrow">¶</a></p>
<span id="name-an-example-merkle-tree-for-"></span><div id="fig-example-tree">
<figure id="figure-2">
            <div id="section-5.5.1-10.1">
              <div class="alignLeft art-svg artwork" id="section-5.5.1-10.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="320" viewBox="0 0 320 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 144,96 L 152,112" fill="none" stroke="black"></path>
                  <path d="M 244,40 L 256,64" fill="none" stroke="black"></path>
                  <path d="M 272,96 L 280,112" fill="none" stroke="black"></path>
                  <path d="M 120,112 L 128,96" fill="none" stroke="black"></path>
                  <path d="M 144,64 L 156,40" fill="none" stroke="black"></path>
                  <path d="M 248,112 L 256,96" fill="none" stroke="black"></path>
                  <path d="M 156,40 L 180,40" fill="none" stroke="black"></path>
                  <path d="M 220,40 L 244,40" fill="none" stroke="black"></path>
                  <g class="text">
                    <text x="24" y="36">level</text>
                    <text x="60" y="36">2:</text>
                    <text x="200" y="36">t20</text>
                    <text x="24" y="84">level</text>
                    <text x="60" y="84">1:</text>
                    <text x="136" y="84">t10</text>
                    <text x="264" y="84">t11</text>
                    <text x="24" y="132">level</text>
                    <text x="60" y="132">0:</text>
                    <text x="104" y="132">t00</text>
                    <text x="168" y="132">t01</text>
                    <text x="232" y="132">t02</text>
                    <text x="296" y="132">empty</text>
                    <text x="104" y="148">|</text>
                    <text x="168" y="148">|</text>
                    <text x="232" y="148">|</text>
                    <text x="108" y="164">a0</text>
                    <text x="172" y="164">a1</text>
                    <text x="236" y="164">a2</text>
                  </g>
                </svg><a href="#section-5.5.1-10.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-an-example-merkle-tree-for-" class="selfRef">An example Merkle Tree for three assertions</a>
            </figcaption></figure>
</div>
<p id="section-5.5.1-11">If <code>n</code> is zero, the CA does not build a tree and the tree head is <code>HashEmpty(0, 0)</code>.<a href="#section-5.5.1-11" class="pilcrow">¶</a></p>
<p id="section-5.5.1-12">If <code>n</code> is one, the tree contains a single level, level 0, and has a tree head of <code>HashAssertion(assertion[0], not_after[0], 0)</code>.<a href="#section-5.5.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="signing">
<section id="section-5.5.2">
          <h4 id="name-signing-a-validitywindow">
<a href="#section-5.5.2" class="section-number selfRef">5.5.2. </a><a href="#name-signing-a-validitywindow" class="section-name selfRef">Signing a ValidityWindow</a>
          </h4>
<p id="section-5.5.2-1">Batches are grouped into consecutive ranges of <code>validity_window_size</code> batches, called validity windows. As <code>validity_window_size</code> is computed to cover the full certificate lifetime, a validity window that ends at the latest batch number covers all certificates that may still be valid from a CA.<a href="#section-5.5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.5.2-2">Validity Windows are serialized into the following structure:<a href="#section-5.5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.2-3">
<pre>
opaque TreeHead[hash.length];

struct {
    uint32 batch_number;
    TreeHead tree_heads[validity_window_size*hash.length];
} ValidityWindow;
</pre><a href="#section-5.5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.5.2-4"><code>batch_number</code> is the batch number of the highest batch in the validity window.<a href="#section-5.5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.5.2-5"><code>tree_heads</code> value contains the last <code>validity_window_size</code> tree heads. (Recall the TLS presentation language brackets the total length of a vector in bytes; not the number of elements.) <code>tree_heads</code> starts from <code>batch_number</code>, in decreasing batch number order. That is, <code>tree_heads[0]</code> is the tree head for batch <code>batch_number</code>, <code>tree_heads[1]</code> is the tree head for <code>batch_number - 1</code>, and so on. If <code>batch_number &lt; validity_window_size - 1</code>, any tree heads for placeholder negative batch numbers are filled with <code>HashEmpty(0, 0)</code>, computed with <code>batch_number</code> set to 0.<a href="#section-5.5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.5.2-6">After the CA builds the Merkle Tree for a batch, it constructs the ValidityWindow structure whose <code>batch_number</code> is the number of the batch being issued. It then computes a signature over the following structure:<a href="#section-5.5.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.2-7">
<pre>
struct {
    uint8 label[32] = "Merkle Tree Crts ValidityWindow\0";
    TrustAnchorIdentifier issuer_id;
    ValidityWindow window;
} LabeledValidityWindow;
</pre><a href="#section-5.5.2-7" class="pilcrow">¶</a>
</div>
<p id="section-5.5.2-8">The <code>label</code> field is an ASCII string. The final byte of the string, "\0", is a zero byte, or ASCII NULL character. The <code>issuer_id</code> field is the CA's <code>issuer_id</code>. Other parties can verify the signature by constructing the same input and verifying with the CA's <code>public_key</code>.<a href="#section-5.5.2-8" class="pilcrow">¶</a></p>
<p id="section-5.5.2-9">The CA saves this signature as the batch's validity window signature. It then updates the latest batch to point to <code>batch_number</code>. A CA which generates such a signature is considered to have certified every assertion contained in every value in the <code>tree_heads</code> list, with expiry determined by <code>batch_number</code>, the position of the tree head in the list, and the CA's input parameters as described in <a href="#parameters" class="auto internal xref">Section 5.1</a>.<a href="#section-5.5.2-9" class="pilcrow">¶</a></p>
<p id="section-5.5.2-10">A CA MUST NOT generate signatures over inputs that are parseable as LabeledValidityWindow, except via the above process. If a LabeledValidityWindow structure that was not produced in this way has a valid signature by CA's <code>public_key</code>, this indicates misuse of the private key by the CA, even if the preimages to the <code>tree_heads</code> values, or intermediate nodes, or <code>subject_info_hash</code> values are not known.<a href="#section-5.5.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proofs">
<section id="section-5.5.3">
          <h4 id="name-certificate-format">
<a href="#section-5.5.3" class="section-number selfRef">5.5.3. </a><a href="#name-certificate-format" class="section-name selfRef">Certificate Format</a>
          </h4>
<p id="section-5.5.3-1">[[TODO: BikeshedCertificate is a placeholder name until someone comes up with a better one. #15 ]]<a href="#section-5.5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.5.3-2">For each assertion in the tree, the CA constructs a BikeshedCertificate structure containing the assertion and a proof. A proof is a message that allows the relying party to accept the associated assertion, provided it trusts the CA and recognizes the tree head. The structures are defined below:<a href="#section-5.5.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.3-3">
<pre>
/* See Section 4.1 of draft-beck-tls-trust-anchor-ids */
opaque TrustAnchorIdentifier&lt;1..2^8-1&gt;;

uint64 Timestamp;

struct {
    TrustAnchorIdentifier trust_anchor;
    Timestamp not_after;
    opaque proof_data&lt;0..2^16-1&gt;;
} Proof;

struct {
    Assertion assertion;
    Proof proof;
} BikeshedCertificate;
</pre><a href="#section-5.5.3-3" class="pilcrow">¶</a>
</div>
<p id="section-5.5.3-4">A proof's <code>trust_anchor</code> field is a trust anchor identifier (see <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-3" class="relref">Section 3</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span> and <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-4.1" class="relref">Section 4.1</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>), which determines the proof's type and issuer.
It is analogous to an X.509 trust anchor's subject name.
When the issuer is a Merkle Tree CA, the <code>trust_anchor</code> is a batch's <code>batch_id</code>, as described in <a href="#identifying" class="auto internal xref">Section 5.2</a>.<a href="#section-5.5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.5.3-5">A proof's <code>not_after</code> field is a POSIX timestamp (see <a href="#time" class="auto internal xref">Section 2.1</a>) describing the time after which the proof is no longer valid.<a href="#section-5.5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.5.3-6">A proof's <code>proof_data</code> field is a byte string, opaque to the subscriber, in some format agreed upon by the proof issuer and relying party. If the issuer is a Merkle Tree CA, as defined in this document, the <code>proof_data</code> contains a MerkleTreeProofSHA256, described below. Future mechanisms using the BikeshedCertificate may define other formats.<a href="#section-5.5.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.3-7">
<pre>
opaque HashValueSHA256[32];

struct {
    uint64 index;
    HashValueSHA256 path&lt;0..2^16-1&gt;;
} MerkleTreeProofSHA256;
</pre><a href="#section-5.5.3-7" class="pilcrow">¶</a>
</div>
<p id="section-5.5.3-8">After building the tree, the CA constructs a MerkleTreeProofSHA256 for each assertion as follows. For each index <code>i</code> in the batch's assertion list:<a href="#section-5.5.3-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.5.3-9">
<li id="section-5.5.3-9.1">
              <p id="section-5.5.3-9.1.1">Set <code>index</code> to <code>i</code>. This will be a value between <code>0</code> and <code>n-1</code>, inclusive.<a href="#section-5.5.3-9.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-5.5.3-9.2">
              <p id="section-5.5.3-9.2.1">Set <code>path</code> to an array of <code>l-1</code> hashes. Set element <code>j</code> of this array to element
<code>k</code> of level <code>j</code>, where <code>k</code> is <code>(i &gt;&gt; j) ^ 1</code>. <code>&gt;&gt;</code> denotes a bitwise
right-shift, and <code>^</code> denotes a bitwise exclusive OR (XOR) operation. This
element is the sibling of an ancestor of assertion <code>i</code> in the tree. Note the
tree head is never included.<a href="#section-5.5.3-9.2.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-5.5.3-10">For example, the <code>path</code> value for the third assertion in a batch of three assertions would contain the marked nodes in <a href="#fig-example-proof" class="auto internal xref">Figure 3</a>, from bottom to top.<a href="#section-5.5.3-10" class="pilcrow">¶</a></p>
<span id="name-an-example-merkle-tree-proo"></span><div id="fig-example-proof">
<figure id="figure-3">
            <div id="section-5.5.3-11.1">
              <div class="alignLeft art-svg artwork" id="section-5.5.3-11.1.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="320" viewBox="0 0 320 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                  <path d="M 144,96 L 152,112" fill="none" stroke="black"></path>
                  <path d="M 244,40 L 256,64" fill="none" stroke="black"></path>
                  <path d="M 272,96 L 280,112" fill="none" stroke="black"></path>
                  <path d="M 120,112 L 128,96" fill="none" stroke="black"></path>
                  <path d="M 144,64 L 156,40" fill="none" stroke="black"></path>
                  <path d="M 248,112 L 256,96" fill="none" stroke="black"></path>
                  <path d="M 156,40 L 180,40" fill="none" stroke="black"></path>
                  <path d="M 220,40 L 244,40" fill="none" stroke="black"></path>
                  <g class="text">
                    <text x="24" y="36">level</text>
                    <text x="60" y="36">2:</text>
                    <text x="200" y="36">t20</text>
                    <text x="24" y="84">level</text>
                    <text x="60" y="84">1:</text>
                    <text x="132" y="84">*t10</text>
                    <text x="264" y="84">t11</text>
                    <text x="24" y="132">level</text>
                    <text x="60" y="132">0:</text>
                    <text x="104" y="132">t00</text>
                    <text x="168" y="132">t01</text>
                    <text x="232" y="132">t02</text>
                    <text x="292" y="132">*empty</text>
                    <text x="104" y="148">|</text>
                    <text x="168" y="148">|</text>
                    <text x="232" y="148">|</text>
                    <text x="108" y="164">a0</text>
                    <text x="172" y="164">a1</text>
                    <text x="236" y="164">a2</text>
                  </g>
                </svg><a href="#section-5.5.3-11.1.1" class="pilcrow">¶</a>
</div>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-an-example-merkle-tree-proo" class="selfRef">An example Merkle Tree proof for the third of three assertions</a>
            </figcaption></figure>
</div>
<p id="section-5.5.3-12">If the batch only contained one assertion, <code>path</code> will be empty and <code>index</code> will be zero.<a href="#section-5.5.3-12" class="pilcrow">¶</a></p>
<p id="section-5.5.3-13">For each assertion, the CA assembles a BikeshedCertificate structure and sends it to the subscriber.<a href="#section-5.5.3-13" class="pilcrow">¶</a></p>
<p id="section-5.5.3-14">This certificate can be presented to supporting relying parties as described in <a href="#using" class="auto internal xref">Section 6</a>. It is valid until the batch expires.<a href="#section-5.5.3-14" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sizes">
<section id="section-5.6">
        <h3 id="name-size-estimates">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-size-estimates" class="section-name selfRef">Size Estimates</a>
        </h3>
<p id="section-5.6-1">Merkle Tree proofs scale logarithmically in the batch size. <a href="#rolling-renewal" class="auto internal xref">Section 11.2</a> recommends subscribers renew halfway through the previous certificate's lifetime. Batch sizes will thus, on average, be <code>subscriber_count * 2 / validity_window_size</code>, where <code>subscriber_count</code> is a CA's active subscriber count. The recommended parameters in <a href="#parameters" class="auto internal xref">Section 5.1</a> give an average of <code>subscriber_count / 168</code>.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">Some organizations have published statistics which can estimate batch sizes for the Web PKI. On March 7th, 2023, <span>[<a href="#LetsEncrypt" class="cite xref">LetsEncrypt</a>]</span> reported around 330,000,000 active subscribers for a single CA. <span>[<a href="#MerkleTown" class="cite xref">MerkleTown</a>]</span> reported around 3,800,000,000 unexpired certificates in Certificate Transparency logs, and an issuance rate of around 257,000 per hour. Note the numbers from <span>[<a href="#MerkleTown" class="cite xref">MerkleTown</a>]</span> represent, respectively, all Web PKI CAs combined and issuance rates for longer-lived certificates and may not be representative of a Merkle Tree certificate deployment.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<p id="section-5.6-3">These three estimates correspond to batch sizes of, respectively, around 2,000,000, around 20,000,000, and 257,000. The corresponding <code>path</code> lengths will be 20, 24, and 17, given proof sizes of, respectively, 640 bytes, 768 bytes, and 544 bytes.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">For larger batch sizes, 32 hashes, or 1024 bytes, is sufficient for batch sizes up to 2^33 (8,589,934,592) certificates.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="using">
<section id="section-6">
      <h2 id="name-using-certificates">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-using-certificates" class="section-name selfRef">Using Certificates</a>
      </h2>
<p id="section-6-1">This section describes how subscribers present and relying parties verify Merkle Tree certificates.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="relying-parties">
<section id="section-6.1">
        <h3 id="name-relying-party-state">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-relying-party-state" class="section-name selfRef">Relying Party State</a>
        </h3>
<p id="section-6.1-1">For each Merkle Tree CA it trusts, a relying party maintains a copy of the most recent validity window from the CA. This structure determines which certificates the relying party will accept. It is regularly updated from the transparency service, as described in <a href="#transparency-service" class="auto internal xref">Section 7</a>.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Each batch in the relying party's validity window is a trust anchor for purposes of certificate verification (see <a href="#verifying" class="auto internal xref">Section 6.2</a>) and certificate negotiation (see <a href="#certificate-negotiation" class="auto internal xref">Section 10.3</a>).<a href="#section-6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="verifying">
<section id="section-6.2">
        <h3 id="name-certificate-verification">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-certificate-verification" class="section-name selfRef">Certificate Verification</a>
        </h3>
<p id="section-6.2-1">This section describes the verification process for a BikeshedCertificate. It describes error conditions with TLS alerts, defined in <span><a href="https://rfc-editor.org/rfc/rfc8446#section-6.2" class="relref">Section 6.2</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>. Non-TLS applications SHOULD map these error conditions to the corresponding application-specific errors. When multiple error conditions apply, the application MAY return any applicable error.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">When a subscriber presents a BikeshedCertificate, the relying party runs the following procedure:<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-3">
<li id="section-6.2-3.1">
            <p id="section-6.2-3.1.1">Determines if <code>trust_anchor</code> corresponds to a supported trust anchor, and the type of that trust anchor. If <code>trust_anchor</code> is unrecognized, the relying party rejects the certificate with an <code>unknown_ca</code> error.<a href="#section-6.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-3.2">
            <p id="section-6.2-3.2.1">Run the verification subroutine corresponding to that trust anchor, defined below.<a href="#section-6.2-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-3.3">
            <p id="section-6.2-3.3.1">If the current time is greater than the <code>not_after</code> field, abort this procedure with a <code>certificate_expired</code> error.<a href="#section-6.2-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-3.4">
            <p id="section-6.2-3.4.1">Optionally, perform any additional application-specific checks on the assertion and issuer. For example, an HTTPS client might constrain an issuer to a particular DNS subtree.<a href="#section-6.2-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-3.5">
            <p id="section-6.2-3.5.1">If all the preceding checks succeed, the certificate is valid and the application can proceed with using the assertion.<a href="#section-6.2-3.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.2-4">Step 2 in the above procedure runs a trust-anchor-specific verification subroutine. This subroutine is determined by the type of trust anchor. Each mechanism using the BikeshedCertificate format MUST define a verification subroutine.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">For a Merkle Tree trust anchor, the trust anchor will identify a batch in the relying party's validity window. (See <a href="#identifying" class="auto internal xref">Section 5.2</a> and <a href="#relying-parties" class="auto internal xref">Section 6.1</a>.) The batch's verification subroutine is defined below:<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-6">
<li id="section-6.2-6.1">
            <p id="section-6.2-6.1.1">Compute the batch's expiration time, as described in <a href="#parameters" class="auto internal xref">Section 5.1</a>. If this value is before the <code>not_after</code> field, abort this procedure with a <code>bad_certificate</code> error.<a href="#section-6.2-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.2">
            <p id="section-6.2-6.2.1">Set <code>hash</code> to the output of <code>HashAssertion(assertion, not_after, index)</code>. Set <code>remaining</code> to the certificate's <code>index</code> value.<a href="#section-6.2-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.3">
            <p id="section-6.2-6.3.1">For each element <code>v</code> at zero-based index <code>i</code> of the certificate's <code>path</code> field, in order:<a href="#section-6.2-6.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-6.3.2.1">
                <p id="section-6.2-6.3.2.1.1">If <code>remaining</code> is odd, set <code>hash</code> to the output of <code>HashNode(v, hash, i + 1, remaining &gt;&gt; 1)</code>.
Otherwise, set <code>hash</code> to the output of <code>HashNode(hash, v, i + 1, remaining &gt;&gt; 1)</code><a href="#section-6.2-6.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-6.2-6.3.2.2">
                <p id="section-6.2-6.3.2.2.1">Set <code>remaining</code> to <code>remaining &gt;&gt; 1</code>.<a href="#section-6.2-6.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li id="section-6.2-6.4">
            <p id="section-6.2-6.4.1">If <code>remaining</code> is non-zero, abort this procedure with an error.<a href="#section-6.2-6.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.5">
            <p id="section-6.2-6.5.1">If <code>hash</code> is not equal to the batch's tree head in the relying party's saved validity window (see <a href="#relying-parties" class="auto internal xref">Section 6.1</a>), abort this procedure with a <code>bad_certificate</code> error.<a href="#section-6.2-6.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-6.6">
            <p id="section-6.2-6.6.1">If all the preceding checks succeed, the Merkle Tree certificate verification subroutine completes successfully.<a href="#section-6.2-6.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="transparency-service">
<section id="section-7">
      <h2 id="name-transparency-services">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-transparency-services" class="section-name selfRef">Transparency Services</a>
      </h2>
<p id="section-7-1">This section describes the role of the transparency service. The transparency service ensures all certificates accepted by the relying party are consistently and publicly logged. It performs three functions:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
          <p id="section-7-2.1.1">Mirror all abridged assertions certified by the CA and present them to monitors<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.2">
          <p id="section-7-2.2.1">Validate all tree heads and validity windows produced by the CA<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.3">
          <p id="section-7-2.3.1">Provide the latest valid validity window to relying parties<a href="#section-7-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-3">In doing so, the transparency service MUST satisfy the following requirements:<a href="#section-7-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-4.1">
          <p id="section-7-4.1.1">The mirrored CA state is append-only. That is, the hashes, signatures, and assertions for a given batch number MUST NOT change.<a href="#section-7-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-4.2">
          <p id="section-7-4.2.1">All tree hashes sent to relying parties MUST be reflected in the mirrored CA state.<a href="#section-7-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-5">The transparency service publishes the mirrored CA state using the same interface as <a href="#publishing" class="auto internal xref">Section 8</a>. The protocol between the relying party and transparency service is out of scope of this document. The relying party MAY use the interface defined here, or an existing application-specific authenticated channel.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">As discussed in <a href="#authenticity" class="auto internal xref">Section 13.1</a>, relying parties MUST ensure that any validity windows obtained were asserted by the CA. This SHOULD be done by having the transparency service forward the CA's signature, with the relying party verifying it. However, if the transparency service already maintains a trusted, authenticated channel to the relying parties (e.g. a software or root store update channel), relying parties MAY rely on the transparency service to validate the signature on their behalf, rather than sending it over this channel.<a href="#section-7-6" class="pilcrow">¶</a></p>
<p id="section-7-7">Although described as a single service for clarity, the transparency service may be implemented as a combination of services run by multiple entities, depending on security goals. For example deployments, this section first describes a single trusted service, then it describes other possible models where trust is divided between entities.<a href="#section-7-7" class="pilcrow">¶</a></p>
<div id="single-trusted-service">
<section id="section-7.1">
        <h3 id="name-single-trusted-service">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-single-trusted-service" class="section-name selfRef">Single Trusted Service</a>
        </h3>
<p id="section-7.1-1">Some relying parties regularly contact a trusted update service, either for software updates or to update individual components, such as the services described in <span>[<a href="#CHROMIUM" class="cite xref">CHROMIUM</a>]</span> and <span>[<a href="#FIREFOX" class="cite xref">FIREFOX</a>]</span>. Where these services are already trusted for the components such as the trust anchor list or certificate validation software, a single trusted transparency service may be a suitable model.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">The transparency service maintains a mirror of the CA's latest batch number, and batch state. Roughly once every <code>batch_duration</code>, it polls the CA's HTTP interface (see <a href="#publishing" class="auto internal xref">Section 8</a>) and runs the following steps:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-3">
<li id="section-7.1-3.1">
            <p id="section-7.1-3.1.1">Fetch the CA's latest batch number.  If this fetch fails, abort this procedure with an error.<a href="#section-7.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.2">
            <p id="section-7.1-3.2.1">Let <code>new_latest_batch</code> be the result and <code>old_latest_batch</code> be the currently mirrored value. If <code>new_latest_batch</code> equals <code>old_latest_batch</code>, finish this procedure without reporting an error.<a href="#section-7.1-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.3">
            <p id="section-7.1-3.3.1">If <code>new_latest_batch</code> is less than <code>old_latest_batch</code>, abort this procedure with an error.<a href="#section-7.1-3.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.4">
            <p id="section-7.1-3.4.1">If the issuance time for batch <code>new_latest_batch</code> is after the current time (see <a href="#parameters" class="auto internal xref">Section 5.1</a>), abort this procedure with an error.<a href="#section-7.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.1-3.5">
            <p id="section-7.1-3.5.1">For all <code>i</code> such that <code>old_latest_batch &lt; i &lt;= new_latest_batch</code>:<a href="#section-7.1-3.5.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-3.5.2">
<li id="section-7.1-3.5.2.1">
                <p id="section-7.1-3.5.2.1.1">Fetch the signature, tree head, and abridged assertion list for batch <code>i</code>. If this fetch fails, abort this procedure with an error.<a href="#section-7.1-3.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-7.1-3.5.2.2">
                <p id="section-7.1-3.5.2.2.1">Compute the tree head for the assertion list, as described in <a href="#building-tree" class="auto internal xref">Section 5.5.1</a>. If this value does not match the fetched tree head, abort this procedure with an error.<a href="#section-7.1-3.5.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-7.1-3.5.2.3">
                <p id="section-7.1-3.5.2.3.1">Compute the ValidityWindow structure and verify the signature, as described in <a href="#signing" class="auto internal xref">Section 5.5.2</a>. Set <code>tree_heads[0]</code> to the tree head fetched above. Set the other values in <code>tree_heads</code> to the previously mirrored values. If signature verification fails, abort this procedure with an error.<a href="#section-7.1-3.5.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li id="section-7.1-3.5.2.4">
                <p id="section-7.1-3.5.2.4.1">Set the mirrored latest batch number to <code>i</code> and save the fetched batch state.<a href="#section-7.1-3.5.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ol>
</li>
        </ol>
<p id="section-7.1-4">[[TODO: If the mirror gets far behind, if the CA just stops publishing for a while, it may suddenly have to catch up on many batches. Should we allow the mirror to catch up to the latest validity window and skip the intervening batches? The intervening batches are guaranteed to have been expired #37 ]]<a href="#section-7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="single-update-multiple-mirrors">
<section id="section-7.2">
        <h3 id="name-single-update-service-with-">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-single-update-service-with-" class="section-name selfRef">Single Update Service with Multiple Mirrors</a>
        </h3>
<p id="section-7.2-1">If the relying party has a trusted update service, but the update service does not have the resources to mirror the full batch state, the transparency service can be composed of this update service and several, less trusted mirrors. In this model, the mirrors are not trusted to serve authoritative trust anchor information to relying parties, but the update service trusts at least half of them to faithfully and consistently mirror the batch state.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Each mirror follows the procedure in <a href="#single-trusted-service" class="auto internal xref">Section 7.1</a> to maintain and publish a mirror of the CA's batch state.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">The update server maintains the latest validity window validated to appear in all mirrors. It updates this by polling the mirrors and running the following steps:<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.2-4">
<li id="section-7.2-4.1">
            <p id="section-7.2-4.1.1">For each mirror, fetch the latest batch number.<a href="#section-7.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.2">
            <p id="section-7.2-4.2.1">Let <code>new_latest_batch</code> be the highest batch number that is bounded by the value fetched from at least half of the mirrors. Let <code>old_latest_batch</code> be the batch number of the currently stored validity window.<a href="#section-7.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.3">
            <p id="section-7.2-4.3.1">If <code>new_latest_batch</code> equals <code>old_latest_batch</code>, finish this procedure without reporting an error.<a href="#section-7.2-4.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.4">
            <p id="section-7.2-4.4.1">If <code>new_latest_batch</code> is less than <code>old_latest_batch</code>, abort this procedure with an error.<a href="#section-7.2-4.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.5">
            <p id="section-7.2-4.5.1">If the issuance time for batch <code>new_latest_batch</code> is after the current time (see <a href="#parameters" class="auto internal xref">Section 5.1</a>), abort this procedure with an error.<a href="#section-7.2-4.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.6">
            <p id="section-7.2-4.6.1">Fetch the validity window with <code>new_latest_batch</code> from each mirror that returned an equal or higher latest batch number. If any fetches fail, or if the results do not match across all mirrors, abort this procedure with an error.<a href="#section-7.2-4.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.7">
            <p id="section-7.2-4.7.1">Verify the validity window signature, as described in <a href="#signing" class="auto internal xref">Section 5.5.2</a>. If the signature is invalid, abort this procedure with an error.<a href="#section-7.2-4.7.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.8">
            <p id="section-7.2-4.8.1">If the old and new validity windows contain overlapping batch numbers, verify that the tree hashes match. If not, abort this procedure with an error.<a href="#section-7.2-4.8.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-4.9">
            <p id="section-7.2-4.9.1">Update the saved validity window with the new value.<a href="#section-7.2-4.9.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.2-5">Compared to <a href="#single-trusted-service" class="auto internal xref">Section 7.1</a>, this model reduces trust in the mirror services, but can delay certificate usability if some of the mirrors consume CA updates too slowly. This can be tuned by adjusting the threshold in step 2.<a href="#section-7.2-5" class="pilcrow">¶</a></p>
<p id="section-7.2-6">In a transparency service using this model, each mirror independently publishes the batch state via <a href="#publishing" class="auto internal xref">Section 8</a>.<a href="#section-7.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-transparency-services">
<section id="section-7.3">
        <h3 id="name-multiple-transparency-servi">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-multiple-transparency-servi" class="section-name selfRef">Multiple Transparency Services</a>
        </h3>
<p id="section-7.3-1">Relying parties without a trusted update service can fetch from mirrors directly. Rather than relying on the update service to fetch the validity window state, the relying party runs the procedure described in <a href="#single-update-multiple-mirrors" class="auto internal xref">Section 7.2</a>, and uses the saved validity window to verify certificates.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="monitors">
<section id="section-7.4">
        <h3 id="name-monitors">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-monitors" class="section-name selfRef">Monitors</a>
        </h3>
<p id="section-7.4-1">Monitors in this document are analogous to monitors in <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span>. Monitors watch an implementation of the HTTP APIs in <a href="#publishing" class="auto internal xref">Section 8</a> to verify correct behavior and watch for certificates of interest. This is typically the transparency service. A monitor needs to, at least, inspect every new batch. It may also maintain a copy of the batch state.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">It does so by following the procedure in <a href="#single-trusted-service" class="auto internal xref">Section 7.1</a>, fetching from the service being monitored. If the procedure fails for a reason other than the service availability, this should be viewed as misbehavior on the part of the service. If the procedure fails due to service availability and the service remains unavailable for an extended period, this should also be viewed as misbehavior. If the monitor is not maintaining a copy of the batch state, it skips saving the abridged assertions.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<p id="section-7.4-3"><span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> additionally defines the role of auditor, which validates that Signed Certificate Timestamps (SCTs) and Signed Tree Heads (STHs) in Certificate Transparency are correct. There is no analog to SCTs in this document. The signed validity window structure (<a href="#signing" class="auto internal xref">Section 5.5.2</a>) is analogous to an STH, but consistency is checked simply by ensuring overlapping tree heads match, so this document does not define this as an explicit role. If two inconsistent signed validity windows are ever observed from a Merkle Tree CA, this should be viewed as misbehavior on the part of the CA.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="publishing">
<section id="section-8">
      <h2 id="name-http-interface">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-http-interface" class="section-name selfRef">HTTP Interface</a>
      </h2>
<p id="section-8-1">[[TODO: This section hasn't been written yet. For now, this is just an informal sketch. The real text will need to define request/response formats more precisely, with MIME types, etc. #12 ]]<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">CAs and transparency services publish state over an HTTP <span>[<a href="#RFC9110" class="cite xref">RFC9110</a>]</span> interface described below.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">CAs and any components of the transparency service that maintain validity window information implement the following interfaces:<a href="#section-8-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-4.1">
          <p id="section-8-4.1.1"><code>GET {prefix}/latest</code> returns the latest batch number.<a href="#section-8-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-4.2">
          <p id="section-8-4.2.1"><code>GET {prefix}/validity-window/latest</code> returns the ValidityWindow structure and signature (see <a href="#signing" class="auto internal xref">Section 5.5.2</a>) for the latest batch number.<a href="#section-8-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-4.3">
          <p id="section-8-4.3.1"><code>GET {prefix}/validity-window/{number}</code> returns the ValidityWindow structure and signature (see <a href="#signing" class="auto internal xref">Section 5.5.2</a>) for batch <code>number</code>, if it is in the "issued" state, and a 404 error otherwise.<a href="#section-8-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-4.4">
          <p id="section-8-4.4.1"><code>GET {prefix}/batch/{number}/info</code> returns the validity window signature and tree head for batch <code>number</code>, if batch <code>number</code> is in the "issued" state, and a 404 error otherwise.<a href="#section-8-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-5">CAs and any components of the transparency service that mirror the full abridged assertion list additionally implement the following interface:<a href="#section-8-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-6.1">
          <p id="section-8-6.1.1"><code>GET {prefix}/batch/{number}/assertions</code> returns the abridged assertion list for batch <code>number</code>, if <code>number</code> is in the issued state, and a 404 error otherwise.<a href="#section-8-6.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-7">If the interface is implemented by a distributed service, with multiple servers, updates may propagate to servers at different times, which will cause temporary inconsistency. This inconsistency can impede this system's transparency goals (<a href="#transparency" class="auto internal xref">Section 13.4</a>).<a href="#section-8-7" class="pilcrow">¶</a></p>
<p id="section-8-8">Services implementing this interface SHOULD wait until batch state is fully propagated to all servers before updating the latest batch number. That is, if any server returns a latest batch number of N in either of the first two HTTP endpoints, batch numbers N and below SHOULD be available under the last three batch-number-specific HTTP endpoints in all servers. If this property does not hold at any time, it is considered a service unavailability.<a href="#section-8-8" class="pilcrow">¶</a></p>
<p id="section-8-9">Individual servers in a service MAY return different latest batch numbers. Individual servers MAY also differ on whether a batch number has a response available or return a 404 error. Provided the above consistency property holds, these two inconsistencies do not constitute service unavailability.<a href="#section-8-9" class="pilcrow">¶</a></p>
<p id="section-8-10"><a href="#ts-and-ca-availability" class="auto internal xref">Section 11.4</a> discusses service availability requirements.<a href="#section-8-10" class="pilcrow">¶</a></p>
<p id="section-8-11">[[TODO: Once a batch has expired, do we allow a CA to stop publishing it? The transparency service can already log it for as long, or as little, as it wishes. We effectively have CT log temporal sharding built into the system. #2 ]]<a href="#section-8-11" class="pilcrow">¶</a></p>
<p id="section-8-12">[[TODO: If we have the validity window endpoint, do we still need to separate "info" and "assertions"? #12]]<a href="#section-8-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acme-extensions">
<section id="section-9">
      <h2 id="name-acme-extensions">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acme-extensions" class="section-name selfRef">ACME Extensions</a>
      </h2>
<p id="section-9-1">[[TODO: This section hasn't been written yet. Instead, what follows is an informal discussion. #13 ]]<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2"><span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-6" class="relref">Section 6</a> of [<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span> defines the bulk of what's needed. The missing parts are:<a href="#section-9-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-3.1">
          <p id="section-9-3.1.1">Some way to specify that the client supports BikeshedCertificate. At minimum a separate MIME type, but it likely needs to be known at order creation.<a href="#section-9-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.2">
          <p id="section-9-3.2.1">Some way to accommodate MTC's long issuance time. ACME has the "processing" state, and the Retry-After header can tell the subscriber when to query again. But the fallback certificate will issue much faster, so they cannot be issued together in the same ACME order, as <span>[<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span> currently does.<a href="#section-9-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-9-3.3">
          <p id="section-9-3.3.1">Use <span>[<a href="#I-D.draft-ietf-acme-ari" class="cite xref">I-D.draft-ietf-acme-ari</a>]</span> to move the renewal logic in <a href="#rolling-renewal" class="auto internal xref">Section 11.2</a> from the subscriber to the ACME server.<a href="#section-9-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-9-4">We should also define a certificate request format, though it is broadly just reusing the Assertion structure. If the CA wishes to check possession of the private key, it'll need to come with a signature or do some online operation (e.g. if it's a KEM key). This is inherently protocol-specific, because the mechanism needs to coexist with the target protocol. (Signed CSRs implicitly assume the target protocol's signature payloads cannot overlap with that of a CSR.)<a href="#section-9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-protocol">
<section id="section-10">
      <h2 id="name-use-in-tls">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-use-in-tls" class="section-name selfRef">Use in TLS</a>
      </h2>
<div id="tls-subject-info">
<section id="section-10.1">
        <h3 id="name-tls-subjects">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-tls-subjects" class="section-name selfRef">TLS Subjects</a>
        </h3>
<p id="section-10.1-1">This section describes the SubjectType for use with TLS <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>. The SubjectType value is <code>tls</code>, and the <code>subject_info</code> field contains a TLSSubjectInfo structure, defined below:<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.1-2">
<pre>
enum { tls(0), (2^16-1) } SubjectType;

struct {
    SignatureScheme signature;
    opaque public_key&lt;1..2^16-1&gt;;
    /* TODO: Should there be an extension list? #38 */
} TLSSubjectInfo;
</pre><a href="#section-10.1-2" class="pilcrow">¶</a>
</div>
<p id="section-10.1-3">A TLSSubjectInfo describes a TLS signing key. The <code>signature</code> field is a SignatureScheme <span><a href="https://rfc-editor.org/rfc/rfc8446#section-4.2.3" class="relref">Section 4.2.3</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> value describing the key type and signature algorithm it uses for CertificateVerify.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">The <code>public_key</code> field contains the subscriber's public key. The encoding is determined by the <code>signature</code> field as follows:<a href="#section-10.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10.1-5">
          <dt id="section-10.1-5.1">RSASSA-PSS algorithms:</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-5.2">
            <p id="section-10.1-5.2.1">The public key is an RSAPublicKey structure <span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span> encoded in DER <span>[<a href="#X.690" class="cite xref">X.690</a>]</span>. BER encodings which are not DER MUST be rejected.<a href="#section-10.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-5.3">ECDSA algorithms:</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-5.4">
            <p id="section-10.1-5.4.1">The public key is a UncompressedPointRepresentation structure defined in <span><a href="https://rfc-editor.org/rfc/rfc8446#section-4.2.8.2" class="relref">Section 4.2.8.2</a> of [<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>, using the curve specified by the SignatureScheme.<a href="#section-10.1-5.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.1-5.5">EdDSA algorithms:</dt>
          <dd style="margin-left: 1.5em" id="section-10.1-5.6">
            <p id="section-10.1-5.6.1">The public key is the byte string encoding defined in <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span><a href="#section-10.1-5.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-10.1-6">This document does not define the public key format for other algorithms. In order for a SignatureScheme to be usable with TLSSubjectInfo, this format must be defined in a corresponding document.<a href="#section-10.1-6" class="pilcrow">¶</a></p>
<p id="section-10.1-7">[[TODO: If other schemes get defined before this document is done, add them here. After that, it's on the other schemes to do it. #39 ]]<a href="#section-10.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-certificate-type">
<section id="section-10.2">
        <h3 id="name-the-bikeshed-certificate-ty">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-the-bikeshed-certificate-ty" class="section-name selfRef">The Bikeshed Certificate Type</a>
        </h3>
<p id="section-10.2-1">[[TODO: Bikeshed is a placeholder name until someone comes up with a better one. #15]]<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">This section defines the <code>Bikeshed</code> TLS certificate type, which may be negotiated with the <code>client_certificate_type</code>, <code>server_certificate_type</code> <span>[<a href="#RFC7250" class="cite xref">RFC7250</a>]</span>, or <code>cert_type</code> <span>[<a href="#RFC6091" class="cite xref">RFC6091</a>]</span> extensions. It can only be negotiated with TLS 1.3 or later. Servers MUST NOT negotiate it in TLS 1.2 or below. If the client receives a ServerHello that negotiates it in TLS 1.2 or below, it MUST abort the connection with an <code>illegal_parameter</code> alert.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
<p id="section-10.2-3">[[TODO: None of these three extensions is quite right for client certificates because the negotiation isn't symmetric. See discussion in <a href="#cert-type-problems" class="auto internal xref">Appendix B</a>. We may need to define another one. #18]]<a href="#section-10.2-3" class="pilcrow">¶</a></p>
<p id="section-10.2-4">When negotiated, the Certificate message MUST contain a single CertificateEntry structure.
CertificateEntry is updated as follows:<a href="#section-10.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-5">
<pre>
enum { Bikeshed(TBD), (255) } CertificateType;

struct {
    select (certificate_type) {
        /* Certificate type defined in this document */
        case Bikeshed:
            BikeshedCertificate certificate;

        /* From RFC 7250 */
        case RawPublicKey:
            opaque ASN1_subjectPublicKeyInfo&lt;1..2^24-1&gt;;

        case X509:
            opaque cert_data&lt;1..2^24-1&gt;;

        /* Additional certificate types based on the
          "TLS Certificate Types" registry */
    };
    Extension extensions&lt;0..2^16-1&gt;;
} CertificateEntry;
</pre><a href="#section-10.2-5" class="pilcrow">¶</a>
</div>
<p id="section-10.2-6">The <code>subject_type</code> field in the certificate MUST be of type <code>tls</code> (<a href="#tls-subject-info" class="auto internal xref">Section 10.1</a>). The CertificateVerify message is computed and processed as in <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>, with the following modifications:<a href="#section-10.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.2-7.1">
            <p id="section-10.2-7.1.1">The signature is computed and verified with the key described in the TLSSubjectInfo. The relying party uses the key decoded from the <code>public_key</code> field, and the subscriber uses the corresponding private key.<a href="#section-10.2-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-10.2-7.2">
            <p id="section-10.2-7.2.1">The SignatureScheme in the CertificateVerify MUST match the <code>signature</code> field in the TLSSubjectInfo.<a href="#section-10.2-7.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-10.2-8">The second modification differs from <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span>. Where <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> allowed an id-rsaEncryption key to sign both <code>rsa_pss_rsae_sha256</code> and <code>rsa_pss_rsae_sha384</code>, TLSSubjectInfo keys are specific to a single algorithm. Future documents MAY relax this restriction for a new SignatureScheme, provided it was designed to be used concurrently with the value in TLSSubjectInfo. In particular, the underlying signature algorithm MUST match, and there MUST be appropriate domain separation between the two modes. For example, <span>[<a href="#I-D.draft-ietf-tls-batch-signing" class="cite xref">I-D.draft-ietf-tls-batch-signing</a>]</span> defines new SignatureSchemes, but the same keypair can be safely used with one of the new values and the corresponding base SignatureScheme.<a href="#section-10.2-8" class="pilcrow">¶</a></p>
<p id="section-10.2-9">If this certificate type is used for either the client or server certificate, the ALPN <span>[<a href="#RFC7301" class="cite xref">RFC7301</a>]</span> extension MUST be negotiated. If no application protocol is selected, endpoints MUST close the connection with a <code>no_application_protocol</code> alert.<a href="#section-10.2-9" class="pilcrow">¶</a></p>
<p id="section-10.2-10">[[TODO: Suppose we wanted to introduce a second SubjectType for TLS, either to add new fields or capture a new kind of key. That would need to be negotiated. We could use another extension, but defining a new certificate type seems most natural. That suggests this certificate type isn't about negotiating BikeshedCertificate in general, but specifically SubjectType.tls and TLSSubjectInfo. So perhaps the certificate type should be TLSSubjectInfo or BikeshedTLS. #7 ]]<a href="#section-10.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificate-negotiation">
<section id="section-10.3">
        <h3 id="name-certificate-negotiation">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-certificate-negotiation" class="section-name selfRef">Certificate Negotiation</a>
        </h3>
<p id="section-10.3-1">Merkle Tree certificates will only be accepted in up-to-date relying parties, and require a negotiation mechanism to use. Merkle Tree certificate implementations SHOULD use the <code>trust_anchors</code> extension <span>[<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span> as described below:<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<p id="section-10.3-2">For each Merkle Tree CA trusted by the relying party, the batches in the validity window each determine a trust anchor, as described in <a href="#relying-parties" class="auto internal xref">Section 6.1</a>. The trust anchor's identifier is the batch identifier, as described in <a href="#identifying" class="auto internal xref">Section 5.2</a>. Future mechanisms using the BikeshedCertificate format (see <a href="#proofs" class="auto internal xref">Section 5.5.3</a>) MUST similarly define how relying parties determine trust anchor identifiers.<a href="#section-10.3-2" class="pilcrow">¶</a></p>
<p id="section-10.3-3">As even a single validity window results in <code>validity_window_size</code> trust anchors, sending all trust anchors in the <code>trust_anchors</code> extension would be prohitively large in most cases. Instead, relying parties SHOULD use the retry mechanism described in <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-4.3" class="relref">Section 4.3</a> of [<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span> and the DNS hint described in <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-5" class="relref">Section 5</a> of [<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span>.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<p id="section-10.3-4">[[TODO: We could reduce the reliance on DNS by adding https://github.com/davidben/tls-trust-expressions/issues/62, either in this draft or the main trust anchor IDs draft.]]<a href="#section-10.3-4" class="pilcrow">¶</a></p>
<p id="section-10.3-5">The subscriber's list of candidate certification paths (see <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>) is extended to carry both X.509 and BikeshedCertificate credentials. The two types of credentials MAY appear in any relative preference order, based on the subscriber's policies. Like an X.509 credential, a BikeshedCertificate credential also has a CertificatePropertyList (see <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-3.1" class="relref">Section 3.1</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>).<a href="#section-10.3-5" class="pilcrow">¶</a></p>
<p id="section-10.3-6">For each of the subscriber's BikeshedCertificate credentials, the corresponding trust anchor identifier is the <code>trust_anchor</code> field in the BikeshedCertificate structure. This differs from X.509 credentials, which require an out-of-band value in the CertificatePropertyList. It is an error for a BikeshedCertificate credential's CertificatePropertyList to contain the <code>trust_anchor_identifier</code> property.<a href="#section-10.3-6" class="pilcrow">¶</a></p>
<p id="section-10.3-7">The subscriber then selects certificates as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-4.2" class="relref">Section 4.2</a> of [<a href="#I-D.draft-beck-tls-trust-anchor-ids" class="cite xref">I-D.draft-beck-tls-trust-anchor-ids</a>]</span>. In doing so, it SHOULD incorporate trust anchor negotiation and certificate type negotiation (see <a href="#tls-certificate-type" class="auto internal xref">Section 10.2</a>) into the selection criteria for BikeshedCertificate-based credentials.<a href="#section-10.3-7" class="pilcrow">¶</a></p>
<p id="section-10.3-8">[[TODO: Certificate type negotiation doesn't work right for client certificates. See <a href="#cert-type-problems" class="auto internal xref">Appendix B</a>]]<a href="#section-10.3-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deployment-considerations">
<section id="section-11">
      <h2 id="name-deployment-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-deployment-considerations" class="section-name selfRef">Deployment Considerations</a>
      </h2>
<div id="fallback-mechanisms">
<section id="section-11.1">
        <h3 id="name-fallback-mechanisms">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-fallback-mechanisms" class="section-name selfRef">Fallback Mechanisms</a>
        </h3>
<p id="section-11.1-1">Subscribers using Merkle Tree certificates SHOULD additionally provision certificates from another PKI mechanism, such as X.509. This ensures the service remains available to relying parties that have not recently fetched validity window updates, or lack connectivity to the transparency service.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">If the pipeline of updates from the CA to the transparency service to relying parties is interrupted, certificate issuance may halt, or newly issued certificates may no longer be usable. When this happens, the optimization in this document may fail, but fallback mechanisms ensure services remain available.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rolling-renewal">
<section id="section-11.2">
        <h3 id="name-rolling-renewal">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-rolling-renewal" class="section-name selfRef">Rolling Renewal</a>
        </h3>
<p id="section-11.2-1">When a subscriber requests a certificate, the CA cannot fulfill the request until the next batch is ready. Once published, the certificate will not be accepted by relying parties until the batch state is mirrored by their respective transparency services, then pushed to relying parties.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<p id="section-11.2-2">To account for this, subscribers SHOULD request a new Merkle Tree certificate significantly before the previous Merkle Tree certificate expires. Renewing halfway into the previous certificate's lifetime is RECOMMENDED. Subscribers additionally SHOULD retain both the new and old certificates in the certificate set until the old certificate expires. As the new tree hash is delivered to relying parties, certificate negotiation will transition relying parties to the new certificate, while retaining the old certificate for clients that are not yet updated.<a href="#section-11.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="new-keys">
<section id="section-11.3">
        <h3 id="name-deploying-new-keys">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-deploying-new-keys" class="section-name selfRef">Deploying New Keys</a>
        </h3>
<p id="section-11.3-1">Merkle Tree certificates' issuance delays make them unsuitable when rapidly deploying a new service and reacting to key compromise.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
<p id="section-11.3-2">When a new service is provisioned with a brand new Merkle Tree certificate, relying parties will not yet have received a validity window containing this certificate from the transparency service and can therefore not validate this certificate until receiving them. The subscriber SHOULD, in parallel, also provision a certificate using another PKI mechanism (e.g. X.509). Certificate negotiation will then switch over to serving the Merkle Tree certificate as relying parties are updated.<a href="#section-11.3-2" class="pilcrow">¶</a></p>
<p id="section-11.3-3">If the service is performing a routine key rotation, and not in response to a known compromise, the subscriber MAY use the process described in <a href="#rolling-renewal" class="auto internal xref">Section 11.2</a>, allowing certificate negotiation to also switch the private key used. This slightly increases the lifetime of the old key but maintains the size optimization continuously.<a href="#section-11.3-3" class="pilcrow">¶</a></p>
<p id="section-11.3-4">If the service is rotating keys in response to a key compromise, this option is not available. Instead, the service SHOULD immediately discard the old key and request a more immediate issuance mechanism. As in the initial deployment case, it SHOULD request a Merkle Tree certificate in parallel, which will restore the size optimization over time.<a href="#section-11.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ts-and-ca-availability">
<section id="section-11.4">
        <h3 id="name-batch-state-availability">
<a href="#section-11.4" class="section-number selfRef">11.4. </a><a href="#name-batch-state-availability" class="section-name selfRef">Batch State Availability</a>
        </h3>
<p id="section-11.4-1">CAs and transparency services serve an HTTP interface defined in <a href="#publishing" class="auto internal xref">Section 8</a>. This service may be temporarily unavailable, either from service outage or if the service does not meet the consistency condition mid-update. Exact availability requirements for these services are out of scope for this document, but this section provides some general guidance.<a href="#section-11.4-1" class="pilcrow">¶</a></p>
<p id="section-11.4-2">If the CA's interface becomes unavailable, the transparency service will be unavailable to update. This will prevent relying parties from accepting new certificates, so subscribers will need to use fallback mechanisms per <a href="#fallback-mechanisms" class="auto internal xref">Section 11.1</a>. This does not compromise transparency goals per <a href="#misbehaving-ca" class="auto internal xref">Section 13.4.2</a>. However, a CA which is persistently unavailable may not offer sufficient benefit to be used by subscribers or trusted by relying parties.<a href="#section-11.4-2" class="pilcrow">¶</a></p>
<p id="section-11.4-3">However, if the transparency service's interface becomes unavailable, monitors will be unable to check for unauthorized certificates. This does compromise transparency goals. Mirrors of the batch state partially mitigate this, but service unavailability may prevent mirrors from replicating a batch that relying parties accept.<a href="#section-11.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-12">
      <h2 id="name-privacy-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-12-1">The Privacy Considerations described in <span><a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01#section-9" class="relref">Section 9</a> of [<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span> apply to its use with Merkle Tree Certificates.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">In particular, relying parties that share a transparency service will fetch the same stream of updates. However, updates may reach different users at different times, resulting in some variation across users. This variation may contribute to a fingerprinting attack <span>[<a href="#RFC6973" class="cite xref">RFC6973</a>]</span>. If the Merkle Tree CA trust anchors are sent unconditionally in <code>trust_anchors</code>, this variation will be passively observable. If they are sent conditionally, e.g. with the DNS-mechanism, the trust anchor list will require active probing.<a href="#section-12-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-13">
      <h2 id="name-security-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="authenticity">
<section id="section-13.1">
        <h3 id="name-authenticity">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-authenticity" class="section-name selfRef">Authenticity</a>
        </h3>
<p id="section-13.1-1">A key security requirement of any PKI scheme is that relying parties only accept assertions that were certified by a trusted certification authority. This is achieved by the following two properties:<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.1-2.1">
            <p id="section-13.1-2.1.1">The relying party MUST NOT accept any validity window that was not authenticated as coming from the CA.<a href="#section-13.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.1-2.2">
            <p id="section-13.1-2.2.1">For any tree head computed from a list of assertions as in <a href="#building-tree" class="auto internal xref">Section 5.5.1</a>, it is computationally infeasible to construct an assertion not this list, and some inclusion proof, such that the procedure in <a href="#verifying" class="auto internal xref">Section 6.2</a> succeeds.<a href="#section-13.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-13.1-3"><a href="#transparency-service" class="auto internal xref">Section 7</a> discusses achieving the first property.<a href="#section-13.1-3" class="pilcrow">¶</a></p>
<p id="section-13.1-4">The second property is achieved by using a collision-resistant hash in the Merkle Tree construction. The <code>HashEmpty</code>, <code>HashNode</code>, and <code>HashAssertion</code> functions use distinct initial bytes when calling the hash function, to achieve domain separation.<a href="#section-13.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cross-protocol">
<section id="section-13.2">
        <h3 id="name-cross-protocol-attacks">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-cross-protocol-attacks" class="section-name selfRef">Cross-protocol attacks</a>
        </h3>
<p id="section-13.2-1">Using the same key material in different, incompatible ways risks cross-protocol attacks when the two uses overlap. To avoid this, <a href="#parameters" class="auto internal xref">Section 5.1</a> forbids the reuse of Merkle Tree CA private keys in another protocol.  A CA MUST NOT generate signatures with its private key, except as defined in <a href="#signing" class="auto internal xref">Section 5.5.2</a>, or an extension of this protocol. Any valid signature of a CA's <code>public_key</code> that does not meet these requirements indicates misuse of the private key by the CA.<a href="#section-13.2-1" class="pilcrow">¶</a></p>
<p id="section-13.2-2">To reduce the risk of attacks if this guidance is not followed, the LabeledValidityWindow structure defined in <a href="#signing" class="auto internal xref">Section 5.5.2</a> includes a label string, and the CA's <code>issuer_id</code>. Extensions of this protocol MAY be defined which reuse the keys, but any that do MUST use a different label string and analyze the security of the two uses concurrently.<a href="#section-13.2-2" class="pilcrow">¶</a></p>
<p id="section-13.2-3">Likewise, key material included in an assertion (<a href="#assertions" class="auto internal xref">Section 4</a>) MUST NOT be used in another protocol, unless that protocol was designed to be used concurrently with the original purpose. The Assertion structure is designed to facilitate this. Where X.509 uses an optional key usage extension (see <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.3" class="relref">Section 4.2.1.3</a> of [<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>) and extended key usage extension (see <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.12" class="relref">Section 4.2.1.12</a> of [<a href="#RFC5280" class="cite xref">RFC5280</a>]</span>) to specify key usage, an Assertion is always defined first by a SubjectType value. Subjects cannot be constructed without first specifying the type, and subjects of different types cannot be accidentally interpreted as each other.<a href="#section-13.2-3" class="pilcrow">¶</a></p>
<p id="section-13.2-4">The TLSSubjectInfo structure additionally protects against cross-protocol attacks in two further ways:<a href="#section-13.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.2-5.1">
            <p id="section-13.2-5.1.1">A TLSSubjectInfo specifies the key type not with a SubjectPublicKeyInfo <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.1.2.7" class="relref">Section 4.1.2.7</a> of [<a href="#RFC5280" class="cite xref">RFC5280</a>]</span> object identifier, but with a SignatureScheme structure. Where <span>[<a href="#RFC8446" class="cite xref">RFC8446</a>]</span> allows an id-rsaEncryption key to sign both <code>rsa_pss_rsae_sha256</code> and <code>rsa_pss_rsae_sha384</code>, this protocol specifies the full signature algorithm parameters.<a href="#section-13.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-13.2-5.2">
            <p id="section-13.2-5.2.1">To mitigate cross-protocol attacks at the application protocol <span>[<a href="#ALPACA" class="cite xref">ALPACA</a>]</span>, this document requires connections using it to negotiate the ALPN <span>[<a href="#RFC7301" class="cite xref">RFC7301</a>]</span> extension.<a href="#section-13.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="revocation">
<section id="section-13.3">
        <h3 id="name-revocation">
<a href="#section-13.3" class="section-number selfRef">13.3. </a><a href="#name-revocation" class="section-name selfRef">Revocation</a>
        </h3>
<p id="section-13.3-1">Merkle Tree certificates avoid sending an additional signature for OCSP responses by using a short-lived certificates model. Per <a href="#parameters" class="auto internal xref">Section 5.1</a>,  Merkle Tree CA's certificate lifetime MUST be set such that certificate expiration replaces revocation. Existing revocation mechanisms like CRLs and OCSP are themselves short-lived, signed messages, so a low enough certificate lifetime provides equivalent revocation capability.<a href="#section-13.3-1" class="pilcrow">¶</a></p>
<p id="section-13.3-2">Relying parties with additional sources of revocation such as <span>[<a href="#CRLite" class="cite xref">CRLite</a>]</span> or <span>[<a href="#CRLSets" class="cite xref">CRLSets</a>]</span> SHOULD provide a mechanism to express revoked assertions in such systems, in order to opportunistically revoke assertions in up-to-date relying parties sooner. It is expected that, in most deployments, relying parties can fetch this revocation data and Merkle Tree CA validity windows from the same service.<a href="#section-13.3-2" class="pilcrow">¶</a></p>
<p id="section-13.3-3">[[TODO: Is it worth defining an API for Merkle Tree CAs to publish a revocation list? That would allow automatically populating CRLite and CRLSets. Maybe that's a separate document. #41]]<a href="#section-13.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transparency">
<section id="section-13.4">
        <h3 id="name-transparency">
<a href="#section-13.4" class="section-number selfRef">13.4. </a><a href="#name-transparency" class="section-name selfRef">Transparency</a>
        </h3>
<p id="section-13.4-1">The transparency service does not prevent unauthorized certificates, but it aims to provide comparable security properties to Certificate Transparency <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span>. If a subscriber presents an acceptable Merkle Tree certificate to a relying party, the relying party should have assurance it was published in some form that monitors and, in particular, the subject of the certificate will be able to notice.<a href="#section-13.4-1" class="pilcrow">¶</a></p>
<div id="unauthorized-certificates">
<section id="section-13.4.1">
          <h4 id="name-unauthorized-certificates">
<a href="#section-13.4.1" class="section-number selfRef">13.4.1. </a><a href="#name-unauthorized-certificates" class="section-name selfRef">Unauthorized Certificates</a>
          </h4>
<p id="section-13.4.1-1">If a Merkle Tree certificate was unauthorized, but seen and mirrored by the transparency service, the relying party may accept it. However, provided the transparency service is operating correctly, this will be detectable. Unlike Certificate Transparency, Merkle Tree certificates achieve this property without a Maximum Merge Delay (MMD). Certificates are fully mirrored by the transparency service before the relying party will accept them. However, this comes at the cost of immediate issuance, as described in <a href="#deployment-considerations" class="auto internal xref">Section 11</a>.<a href="#section-13.4.1-1" class="pilcrow">¶</a></p>
<p id="section-13.4.1-2">If the unauthorized certificate was not seen by the transparency service, the relying party will reject it. In order to accept a certificate, the relying party must have been provisioned with the corresponding tree head. A correctly operating transparency service will never present relying parties with tree heads unless the corresponding certificates have all been mirrored.<a href="#section-13.4.1-2" class="pilcrow">¶</a></p>
<p id="section-13.4.1-3">Unlike Certificate Transparency, the transparency service will not provide the preimages for <code>subject_info_hash</code>, only the hashed values. This is intended to reduce serving costs, particularly with large post-quantum keys. As a result, monitors look for unrecognized hashes instead of unrecognized keys. Any unrecognized hash, even if the preimage is unknown, indicates an unauthorized certificate.<a href="#section-13.4.1-3" class="pilcrow">¶</a></p>
<p id="section-13.4.1-4">This optimization complicates studies of weak public keys, e.g. <span>[<a href="#SharedFactors" class="cite xref">SharedFactors</a>]</span>. Such studies will have to retrieve the public keys separately, such as by connecting to the TLS servers, or fetching from the CA if it retains the unabridged assertion. This document does not define a mechanism for doing this.<a href="#section-13.4.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="misbehaving-ca">
<section id="section-13.4.2">
          <h4 id="name-misbehaving-certification-a">
<a href="#section-13.4.2" class="section-number selfRef">13.4.2. </a><a href="#name-misbehaving-certification-a" class="section-name selfRef">Misbehaving Certification Authority</a>
          </h4>
<p id="section-13.4.2-1">Although CAs in this document publish structures similar to a Certificate Transparency log, they do not need to function correctly to provide transparency.<a href="#section-13.4.2-1" class="pilcrow">¶</a></p>
<p id="section-13.4.2-2">A CA could violate the append-only property of its batch state, and present differing views to different parties. Unlike a misbehaving Certificate Transparency log, this would not compromise transparency. Whichever view is presented to the transparency service at the time of updates determines the canonical batch state for both relying parties and monitors. Certificates that are consistent with only the other view will be rejected by relying parties. If the transparency service observes both views, the procedures in <a href="#transparency-service" class="auto internal xref">Section 7</a> will prevent the new, conflicting view from overwriting the originally saved view. Instead, the update process will fail and further certificates will not be accepted.<a href="#section-13.4.2-2" class="pilcrow">¶</a></p>
<p id="section-13.4.2-3">A CA could also sign a validity window containing an unauthorized certificate and feign an outage when asked to serve the corresponding assertions. However, if the assertion list was never mirrored by the transparency service, the tree head will never be pushed to relying parties, so the relying party will reject the certificate. If the assertion list was mirrored, the unauthorized certificate continues to be available to monitors.<a href="#section-13.4.2-3" class="pilcrow">¶</a></p>
<p id="section-13.4.2-4">As a consequence, monitors MUST use the transparency service's view of the batch state when monitoring for unauthorized certificates. If the transparency service is a collection of mirrors, as in <a href="#single-update-multiple-mirrors" class="auto internal xref">Section 7.2</a> or <a href="#multiple-transparency-services" class="auto internal xref">Section 7.3</a>, monitors MUST monitor each mirror. Monitors MAY optionally monitor the CA directly, but this alone is not sufficient to avoid missing certificates.<a href="#section-13.4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="misbehaving-transparency-service">
<section id="section-13.4.3">
          <h4 id="name-misbehaving-transparency-se">
<a href="#section-13.4.3" class="section-number selfRef">13.4.3. </a><a href="#name-misbehaving-transparency-se" class="section-name selfRef">Misbehaving Transparency Service</a>
          </h4>
<p id="section-13.4.3-1">This document divides CA and transparency service responsibilities differently from how <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> divides CA and Certificate Transparency log. The previous section describes the implications of a failure to meet the log-like responsibilities of a CA, provided the transparency service is operating correctly.<a href="#section-13.4.3-1" class="pilcrow">¶</a></p>
<p id="section-13.4.3-2">For the remainder of log-like responsibilities, the relying party trusts its choice of transparency service deployment to ensure the validity windows it uses are consistent with what monitors observe. Otherwise, a malicious transparency service and CA could collude to cause a relying party to accept an unauthorized certificate not visible to monitors. Where a single trusted service is not available, the <a href="#transparency-service" class="auto internal xref">Section 7</a> discusses possible deployment structures where the transparency service is a collection of mirrors, all or most of whom must collude instead.<a href="#section-13.4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-of-fallback-mechanisms">
<section id="section-13.5">
        <h3 id="name-security-of-fallback-mechan">
<a href="#section-13.5" class="section-number selfRef">13.5. </a><a href="#name-security-of-fallback-mechan" class="section-name selfRef">Security of Fallback Mechanisms</a>
        </h3>
<p id="section-13.5-1">Merkle Tree certificates are intended to be used as an optimization over other PKI mechanisms. More generally, certificate negotiation allows relying parties to support many kinds of certificates, to meet different goals. This document discusses the security properties of Merkle Tree certificates, but the overall system's security properties depend on all of a relying party's trust anchors.<a href="#section-13.5-1" class="pilcrow">¶</a></p>
<p id="section-13.5-2">In particular, in relying parties that require a publicly auditable PKI, the supported fallback mechanisms must also provide a transparency property, either with Certificate Transparency <span>[<a href="#RFC6962" class="cite xref">RFC6962</a>]</span> or another mechanism.<a href="#section-13.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-14">
      <h2 id="name-iana-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-14-1">IANA is requested to create the following entry in the TLS Certificate Types registry <span>[<a href="#RFC8447" class="cite xref">RFC8447</a>]</span>. The "Reference" column should be set to this document.<a href="#section-14-1" class="pilcrow">¶</a></p>
<span id="name-additions-to-the-tls-certif"></span><table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-additions-to-the-tls-certif" class="selfRef">Additions to the TLS Certificate Types Registry</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
            <th class="text-left" rowspan="1" colspan="1">Name</th>
            <th class="text-left" rowspan="1" colspan="1">Recommended</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">TBD</td>
            <td class="text-left" rowspan="1" colspan="1">
              <code>Bikeshed</code>
</td>
            <td class="text-left" rowspan="1" colspan="1">TBD</td>
          </tr>
        </tbody>
      </table>
<p id="section-14-3">[[ TODO: Define registries for the enums introduced in this document. #42]]<a href="#section-14-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14-4.1">
          <p id="section-14-4.1.1">SubjectType<a href="#section-14-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-14-4.2">
          <p id="section-14-4.2.1">ClaimType<a href="#section-14-4.2.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="sec-combined-references">
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.beck-tls-trust-anchor-ids">[I-D.beck-tls-trust-anchor-ids]</dt>
        <dd>
<span class="refAuthor">Beck, B.</span>, <span class="refAuthor">Benjamin, D.</span>, and <span class="refAuthor">D. O'Brien</span>, <span class="refTitle">"TLS Trust Anchor Identifiers"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-beck-tls-trust-anchor-ids-01</span>, <time datetime="2024-09-05" class="refDate">5 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01">https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-beck-tls-trust-anchor-ids">[I-D.draft-beck-tls-trust-anchor-ids]</dt>
        <dd>
<span class="refAuthor">Beck, B.</span>, <span class="refAuthor">Benjamin, D.</span>, and <span class="refAuthor">D. O'Brien</span>, <span class="refTitle">"TLS Trust Anchor Identifiers"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-beck-tls-trust-anchor-ids-01</span>, <time datetime="2024-09-05" class="refDate">5 September 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01">https://datatracker.ietf.org/doc/html/draft-beck-tls-trust-anchor-ids-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-uta-rfc6125bis">[I-D.draft-ietf-uta-rfc6125bis]</dt>
        <dd>
<span class="refAuthor">Saint-Andre, P.</span> and <span class="refAuthor">R. Salz</span>, <span class="refTitle">"Service Identity in TLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-uta-rfc6125bis-15</span>, <time datetime="2023-08-10" class="refDate">10 August 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-uta-rfc6125bis-15">https://datatracker.ietf.org/doc/html/draft-ietf-uta-rfc6125bis-15</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="POSIX">[POSIX]</dt>
        <dd>
<span class="refTitle">"IEEE Standard for Information Technology--Portable Operating System Interface (POSIX(TM)) Base Specifications, Issue 7"</span>, <span class="refContent">IEEE</span>, <span class="seriesInfo">DOI 10.1109/ieeestd.2018.8277153</span>, <span class="seriesInfo">ISBN ["9781504445429"]</span>, <time datetime="2018-01" class="refDate">January 2018</time>, <span>&lt;<a href="https://doi.org/10.1109/ieeestd.2018.8277153">https://doi.org/10.1109/ieeestd.2018.8277153</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1034">[RFC1034]</dt>
        <dd>
<span class="refAuthor">Mockapetris, P.</span>, <span class="refTitle">"Domain names - concepts and facilities"</span>, <span class="seriesInfo">STD 13</span>, <span class="seriesInfo">RFC 1034</span>, <span class="seriesInfo">DOI 10.17487/RFC1034</span>, <time datetime="1987-11" class="refDate">November 1987</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1034">https://www.rfc-editor.org/rfc/rfc1034</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1123">[RFC1123]</dt>
        <dd>
<span class="refAuthor">Braden, R., Ed.</span>, <span class="refTitle">"Requirements for Internet Hosts - Application and Support"</span>, <span class="seriesInfo">STD 3</span>, <span class="seriesInfo">RFC 1123</span>, <span class="seriesInfo">DOI 10.17487/RFC1123</span>, <time datetime="1989-10" class="refDate">October 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc1123">https://www.rfc-editor.org/rfc/rfc1123</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5890">[RFC5890]</dt>
        <dd>
<span class="refAuthor">Klensin, J.</span>, <span class="refTitle">"Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework"</span>, <span class="seriesInfo">RFC 5890</span>, <span class="seriesInfo">DOI 10.17487/RFC5890</span>, <time datetime="2010-08" class="refDate">August 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5890">https://www.rfc-editor.org/rfc/rfc5890</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6091">[RFC6091]</dt>
        <dd>
<span class="refAuthor">Mavrogiannopoulos, N.</span> and <span class="refAuthor">D. Gillmor</span>, <span class="refTitle">"Using OpenPGP Keys for Transport Layer Security (TLS) Authentication"</span>, <span class="seriesInfo">RFC 6091</span>, <span class="seriesInfo">DOI 10.17487/RFC6091</span>, <time datetime="2011-02" class="refDate">February 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6091">https://www.rfc-editor.org/rfc/rfc6091</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7250">[RFC7250]</dt>
        <dd>
<span class="refAuthor">Wouters, P., Ed.</span>, <span class="refAuthor">Tschofenig, H., Ed.</span>, <span class="refAuthor">Gilmore, J.</span>, <span class="refAuthor">Weiler, S.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7250</span>, <span class="seriesInfo">DOI 10.17487/RFC7250</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7250">https://www.rfc-editor.org/rfc/rfc7250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7301">[RFC7301]</dt>
        <dd>
<span class="refAuthor">Friedl, S.</span>, <span class="refAuthor">Popov, A.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time datetime="2014-07" class="refDate">July 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7301">https://www.rfc-editor.org/rfc/rfc7301</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
        <dd>
<span class="refAuthor">Moriarty, K., Ed.</span>, <span class="refAuthor">Kaliski, B.</span>, <span class="refAuthor">Jonsson, J.</span>, and <span class="refAuthor">A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8017">https://www.rfc-editor.org/rfc/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8032">https://www.rfc-editor.org/rfc/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8447">[RFC8447]</dt>
        <dd>
<span class="refAuthor">Salowey, J.</span> and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"IANA Registry Updates for TLS and DTLS"</span>, <span class="seriesInfo">RFC 8447</span>, <span class="seriesInfo">DOI 10.17487/RFC8447</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8447">https://www.rfc-editor.org/rfc/rfc8447</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8555">[RFC8555]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Hoffman-Andrews, J.</span>, <span class="refAuthor">McCarney, D.</span>, and <span class="refAuthor">J. Kasten</span>, <span class="refTitle">"Automatic Certificate Management Environment (ACME)"</span>, <span class="seriesInfo">RFC 8555</span>, <span class="seriesInfo">DOI 10.17487/RFC8555</span>, <time datetime="2019-03" class="refDate">March 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8555">https://www.rfc-editor.org/rfc/rfc8555</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9110">https://www.rfc-editor.org/rfc/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SHS">[SHS]</dt>
        <dd>
<span class="refTitle">"Secure hash standard"</span>, <span class="refContent">National Institute of Standards and Technology (U.S.)</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.180-4</span>, <time datetime="2015" class="refDate">2015</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.180-4">https://doi.org/10.6028/nist.fips.180-4</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X.690">[X.690]</dt>
      <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology - ASN.1 encoding Rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)"</span>, <span class="seriesInfo">ISO/IEC 8824-1:2021 </span>, <time datetime="2021-02" class="refDate">February 2021</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ALPACA">[ALPACA]</dt>
        <dd>
<span class="refAuthor">Brinkmann, M.</span>, <span class="refAuthor">Dresen, C.</span>, <span class="refAuthor">Merget, R.</span>, <span class="refAuthor">Poddebniak, D.</span>, <span class="refAuthor">Müller, J.</span>, <span class="refAuthor">Somorovsky, J.</span>, <span class="refAuthor">Schwenk, J.</span>, and <span class="refAuthor">S. Schinzel</span>, <span class="refTitle">"ALPACA: Application Layer Protocol Confusion - Analyzing and Mitigating Cracks in TLS Authentication"</span>, <time datetime="2021-08" class="refDate">August 2021</time>, <span>&lt;<a href="https://www.usenix.org/conference/usenixsecurity21/presentation/brinkmann">https://www.usenix.org/conference/usenixsecurity21/presentation/brinkmann</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="APPLE-CT">[APPLE-CT]</dt>
        <dd>
<span class="refAuthor">Apple</span>, <span class="refTitle">"Apple's Certificate Transparency policy"</span>, <time datetime="2021-03-05" class="refDate">5 March 2021</time>, <span>&lt;<a href="https://support.apple.com/en-us/HT205280">https://support.apple.com/en-us/HT205280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CHROME-CT">[CHROME-CT]</dt>
        <dd>
<span class="refAuthor">Google Chrome</span>, <span class="refTitle">"Chrome Certificate Transparency Policy"</span>, <time datetime="2022-03-17" class="refDate">17 March 2022</time>, <span>&lt;<a href="https://googlechrome.github.io/CertificateTransparency/ct_policy.html">https://googlechrome.github.io/CertificateTransparency/ct_policy.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CHROMIUM">[CHROMIUM]</dt>
        <dd>
<span class="refAuthor">Chromium</span>, <span class="refTitle">"Component Updater"</span>, <time datetime="2022-03-03" class="refDate">3 March 2022</time>, <span>&lt;<a href="https://chromium.googlesource.com/chromium/src/+/main/components/component_updater/README.md">https://chromium.googlesource.com/chromium/src/+/main/components/component_updater/README.md</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CRLite">[CRLite]</dt>
        <dd>
<span class="refAuthor">Larisch, J.</span>, <span class="refAuthor">Choffnes, D.</span>, <span class="refAuthor">Levin, D.</span>, <span class="refAuthor">Maggs, B.</span>, <span class="refAuthor">Mislove, A.</span>, and <span class="refAuthor">C. Wilson</span>, <span class="refTitle">"CRLite: A Scalable System for Pushing All TLS Revocations to All Browsers"</span>, <span class="refContent">IEEE</span>, <span class="seriesInfo">2017 IEEE Symposium on Security and Privacy (SP)</span>, <span class="seriesInfo">DOI 10.1109/sp.2017.17</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://doi.org/10.1109/sp.2017.17">https://doi.org/10.1109/sp.2017.17</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CRLSets">[CRLSets]</dt>
        <dd>
<span class="refAuthor">Chromium</span>, <span class="refTitle">"CRLSets"</span>, <time datetime="2022-08-04" class="refDate">4 August 2022</time>, <span>&lt;<a href="https://www.chromium.org/Home/chromium-security/crlsets/">https://www.chromium.org/Home/chromium-security/crlsets/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Dilithium">[Dilithium]</dt>
        <dd>
<span class="refAuthor">Bai, S.</span>, <span class="refAuthor">Ducas, L.</span>, <span class="refAuthor">Kiltz, E.</span>, <span class="refAuthor">Lepoint, T.</span>, <span class="refAuthor">Lyubashevsky, V.</span>, <span class="refAuthor">Schwabe, P.</span>, <span class="refAuthor">Seiler, G.</span>, and <span class="refAuthor">D. Stehlé</span>, <span class="refTitle">"CRYSTALS-Dilithium Algorithm Specifications and Supporting Documentation"</span>, <time datetime="2021-02-08" class="refDate">8 February 2021</time>, <span>&lt;<a href="https://pq-crystals.org/dilithium/data/dilithium-specification-round3-20210208.pdf">https://pq-crystals.org/dilithium/data/dilithium-specification-round3-20210208.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Falcon">[Falcon]</dt>
        <dd>
<span class="refAuthor">Fouque, P.</span>, <span class="refAuthor">Hoffstein, J.</span>, <span class="refAuthor">Kirchner, P.</span>, <span class="refAuthor">Lyubashevsky, V.</span>, <span class="refAuthor">Pornin, T.</span>, <span class="refAuthor">Prest, T.</span>, <span class="refAuthor">Ricosset, T.</span>, <span class="refAuthor">Seiler, G.</span>, <span class="refAuthor">Whyte, W.</span>, and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"Falcon: Fast-Fourier Lattice-based Compact Signatures over NTRU"</span>, <time datetime="2020-01-10" class="refDate">10 January 2020</time>, <span>&lt;<a href="https://falcon-sign.info/falcon.pdf">https://falcon-sign.info/falcon.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FIREFOX">[FIREFOX]</dt>
        <dd>
<span class="refAuthor">Mozilla</span>, <span class="refTitle">"Firefox Remote Settings"</span>, <time datetime="2022-08-20" class="refDate">20 August 2022</time>, <span>&lt;<a href="https://wiki.mozilla.org/Firefox/RemoteSettings">https://wiki.mozilla.org/Firefox/RemoteSettings</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-acme-ari">[I-D.draft-ietf-acme-ari]</dt>
        <dd>
<span class="refAuthor">Gable, A.</span>, <span class="refTitle">"Automated Certificate Management Environment (ACME) Renewal Information (ARI) Extension"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-acme-ari-05</span>, <time datetime="2024-08-23" class="refDate">23 August 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-acme-ari-05">https://datatracker.ietf.org/doc/html/draft-ietf-acme-ari-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-tls-batch-signing">[I-D.draft-ietf-tls-batch-signing]</dt>
        <dd>
<span class="refAuthor">Benjamin, D.</span>, <span class="refTitle">"Batch Signing for TLS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-batch-signing-00</span>, <time datetime="2020-01-13" class="refDate">13 January 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-tls-batch-signing-00">https://datatracker.ietf.org/doc/html/draft-ietf-tls-batch-signing-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="LetsEncrypt">[LetsEncrypt]</dt>
        <dd>
<span class="refAuthor">Let's Encrypt</span>, <span class="refTitle">"Let's Encrypt Stats"</span>, <time datetime="2023-03-07" class="refDate">7 March 2023</time>, <span>&lt;<a href="https://letsencrypt.org/stats/">https://letsencrypt.org/stats/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MerkleTown">[MerkleTown]</dt>
        <dd>
<span class="refAuthor">Cloudflare, Inc.</span>, <span class="refTitle">"Merkle Town"</span>, <time datetime="2023-03-07" class="refDate">7 March 2023</time>, <span>&lt;<a href="https://ct.cloudflare.com/">https://ct.cloudflare.com/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5280">https://www.rfc-editor.org/rfc/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6066">[RFC6066]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refTitle">"Transport Layer Security (TLS) Extensions: Extension Definitions"</span>, <span class="seriesInfo">RFC 6066</span>, <span class="seriesInfo">DOI 10.17487/RFC6066</span>, <time datetime="2011-01" class="refDate">January 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6066">https://www.rfc-editor.org/rfc/rfc6066</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6960">[RFC6960]</dt>
        <dd>
<span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Myers, M.</span>, <span class="refAuthor">Ankney, R.</span>, <span class="refAuthor">Malpani, A.</span>, <span class="refAuthor">Galperin, S.</span>, and <span class="refAuthor">C. Adams</span>, <span class="refTitle">"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP"</span>, <span class="seriesInfo">RFC 6960</span>, <span class="seriesInfo">DOI 10.17487/RFC6960</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6960">https://www.rfc-editor.org/rfc/rfc6960</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6962">[RFC6962]</dt>
        <dd>
<span class="refAuthor">Laurie, B.</span>, <span class="refAuthor">Langley, A.</span>, and <span class="refAuthor">E. Kasper</span>, <span class="refTitle">"Certificate Transparency"</span>, <span class="seriesInfo">RFC 6962</span>, <span class="seriesInfo">DOI 10.17487/RFC6962</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6962">https://www.rfc-editor.org/rfc/rfc6962</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6973">[RFC6973]</dt>
        <dd>
<span class="refAuthor">Cooper, A.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Peterson, J.</span>, <span class="refAuthor">Morris, J.</span>, <span class="refAuthor">Hansen, M.</span>, and <span class="refAuthor">R. Smith</span>, <span class="refTitle">"Privacy Considerations for Internet Protocols"</span>, <span class="seriesInfo">RFC 6973</span>, <span class="seriesInfo">DOI 10.17487/RFC6973</span>, <time datetime="2013-07" class="refDate">July 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6973">https://www.rfc-editor.org/rfc/rfc6973</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8879">[RFC8879]</dt>
        <dd>
<span class="refAuthor">Ghedini, A.</span> and <span class="refAuthor">V. Vasiliev</span>, <span class="refTitle">"TLS Certificate Compression"</span>, <span class="seriesInfo">RFC 8879</span>, <span class="seriesInfo">DOI 10.17487/RFC8879</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8879">https://www.rfc-editor.org/rfc/rfc8879</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SharedFactors">[SharedFactors]</dt>
      <dd>
<span class="refAuthor">Våge, H. F.</span> and <span class="refAuthor">University of Bergen</span>, <span class="refTitle">"Finding shared RSA factors in the Certificate Transparency logs"</span>, <time datetime="2022-05-13" class="refDate">13 May 2022</time>, <span>&lt;<a href="https://bora.uib.no/bora-xmlui/bitstream/handle/11250/3001128/Masters_thesis__for_University_of_Bergen.pdf">https://bora.uib.no/bora-xmlui/bitstream/handle/11250/3001128/Masters_thesis__for_University_of_Bergen.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="appendix-A">
      <h2 id="name-examples">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<div id="abridgedassertions">
<section id="appendix-A.1">
        <h3 id="name-abridgedassertions">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-abridgedassertions" class="section-name selfRef">(Abridged)Assertions</a>
        </h3>
<p id="appendix-A.1-1">The following is an Assertion claiming <code>example.com</code> for
a TLS subject with Ed25519 public key
<code>c5d2080fa9a489a226b58166dad00be8120931a769c9c6f1f8eefafc38af9065</code>.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-2">
<pre>
00000024 08070020 c5d2080f a9a489a2 26b58166 dad00be8 120931a7 69c9c6f1
f8eefafc 38af9065 00120000 000e000c 0b657861 6d706c65 2e636f6d
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1-3">The corresponding AbridgedAssertion:<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-4">
<pre>
00000022 0807d8e2 c44fc82e 175e5698 b1c25324 6c9a996f c37bad29 fd59b6aa
838b0a93 0b000012 0000000e 000c0b65 78616d70 6c652e63 6f6d
</pre><a href="#appendix-A.1-4" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1-5">Next, we have an Assertion claiming <code>*.example.com</code>, <code>192.0.2.37</code>,
<code>192.0.12.0</code>, <code>198.51.100.60</code> and <code>203.0.113.0</code> for
a TLS subject with RSASSA-PSS public key with modulus <code>264851…51544459</code>
and exponent 65537.<a href="#appendix-A.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-6">
<pre>
00000112 0804010e 3082010a 02820101 00d1cd9c d613c050 929e6418 14b4957c
40f30d07 0927f653 bde7054c 06d53a89 36228b70 72fad4db a186c379 7e00300b
a5b6de8e 7ab3fed4 cb5a537e 7674916a 130a0435 664428a9 7f1983b7 e028b9ab
f24700de 1d6478c9 ae361176 daa64c2f 89b42ec0 270add68 85323401 35d22724
c7bd8f65 075b25b8 96a89ab8 2a2b2194 49b029b8 97e130dc dc96fce1 37351f2b
7a28f1d0 7b710afb 2c796211 d9ba1feb 43d30810 63f19afd b7ba2ab0 e19fd008
e719491d d10ed235 5d4790f0 3039e3a3 31aa2644 2d656716 ebe710f2 4260599a
2d082db1 eccfaa8f f51cfb8e 3dfca0eb e1af59c2 f007b35e 02b0582f 50090018
b78a6b06 c0188ab3 514d60d6 6243e017 8b020301 00010028 0001000e 000c0b65
78616d70 6c652e63 6f6d0002 00120010 c0000225 c0000c00 c633643c cb007100
</pre><a href="#appendix-A.1-6" class="pilcrow">¶</a>
</div>
<p id="appendix-A.1-7">The corresponding AbridgedAssertion:<a href="#appendix-A.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A.1-8">
<pre>
00000022 08049a04 087a4d52 033a0a20 04333359 ccf29703 25684c5f a96f1ca1
35cb2ab1 f2670028 0001000e 000c0b65 78616d70 6c652e63 6f6d0002 00120010
c0000225 c0000c00 c633643c cb007100
</pre><a href="#appendix-A.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cert-type-problems">
<section id="appendix-B">
      <h2 id="name-tls-certificate-type-negoti">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-tls-certificate-type-negoti" class="section-name selfRef">TLS Certificate Type Negotiation Challenges</a>
      </h2>
<p id="appendix-B-1">[[TODO: We may need a new TLS certificate types extension, either in this document or a separate one. For now, this section just informally describes the problem. #18 ]]<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">The server certificate type is negotiated as follows:<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-3.1">
          <p id="appendix-B-3.1.1">The client sends <code>server_certificate_type</code> in ClientHello with accepted certificate types.<a href="#appendix-B-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.2">
          <p id="appendix-B-3.2.1">The server selects a certificate type to use, It sends it in <code>server_certificate_type</code> in EncryptedExtensions.<a href="#appendix-B-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-3.3">
          <p id="appendix-B-3.3.1">The server sends a certificate of the server-selected type in Certificate.<a href="#appendix-B-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-B-4">This model allows the server to select its certificate type based on not just <code>server_certificate_type</code>, but also other ClientHello extensions like <code>certificate_authorities</code> or <code>trust_anchors</code> (<span>[<a href="#I-D.beck-tls-trust-anchor-ids" class="cite xref">I-D.beck-tls-trust-anchor-ids</a>]</span>). In particular, if there is no match in <code>trust_anchors</code>, it can fallback to X.509, rather than staying within the realm of BikeshedCertificate.<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<p id="appendix-B-5">However, the client certificate type is negotiated differently:<a href="#appendix-B-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-6.1">
          <p id="appendix-B-6.1.1">The client sends <code>client_certificate_type</code> in ClientHello with certificates it can send<a href="#appendix-B-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-6.2">
          <p id="appendix-B-6.2.1">The server selects a certificate type to request. It sends it in <code>client_certificate_type</code> in EncryptedExtensions.<a href="#appendix-B-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-6.3">
          <p id="appendix-B-6.3.1">The server requests a client certificate in CertificateRequest<a href="#appendix-B-6.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-6.4">
          <p id="appendix-B-6.4.1">The client sends a certificate of the server-selected type in Certificate.<a href="#appendix-B-6.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="appendix-B-7">Here, the client (subscriber) does not select the certificate type. The server (relying party) does. Moreover, this selection is made before the client can see the server's <code>certificate_authorities</code> or <code>trust_anchors</code> value, in CertificateRequest. There is no opportunity for the client to fallback to X.509.<a href="#appendix-B-7" class="pilcrow">¶</a></p>
<p id="appendix-B-8">The <code>cert_types</code> extension behaves similarly, but additionally forces the client and server types to match. These extensions were defined when TLS 1.2 was current, but TLS 1.3 aligns the client and server certificate negotiation. Most certificate negotiation extensions, such as <code>certificate_authorities</code> or <code>compress_certificate</code> <span>[<a href="#RFC8879" class="cite xref">RFC8879</a>]</span> can be offered in either direction, in ClientHello or CertificateRequest. They are then symmetrically accepted in the Certificate message.<a href="#appendix-B-8" class="pilcrow">¶</a></p>
<p id="appendix-B-9">A more corresponding TLS 1.3 negotiation would be to defer the client certificate type negotiation to CertificateRequest, with the server offering the supported certificate types. The client can then make its selection, taking other CertificateRequest extensions into account, and indicate its selection in the Certificate message.<a href="#appendix-B-9" class="pilcrow">¶</a></p>
<p id="appendix-B-10">Two possible design sketches:<a href="#appendix-B-10" class="pilcrow">¶</a></p>
<div id="indicate-in-first-certificateentry">
<section id="appendix-B.1">
        <h3 id="name-indicate-in-first-certifica">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-indicate-in-first-certifica" class="section-name selfRef">Indicate in First CertificateEntry</a>
        </h3>
<p id="appendix-B.1-1">We can have the subscriber indicate the certificate type in an extension of the first CertificateEntry. One challenge is the extensions come after the certificate, so the relying party must seek to the <code>extensions</code> field independent of the certificate type. Thus all certificate types must be updated to use a consistent <code>opaque cert_data&lt;0..2^24&gt;</code> syntax, with any type-specific structures embedded inside.<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<p id="appendix-B.1-2">RawPublicKey and X509 already meet this requirement. OpenPGP and Bikeshed need an extra length prefix.<a href="#appendix-B.1-2" class="pilcrow">¶</a></p>
<div id="change-certificate-syntax">
<section id="appendix-B.1.1">
          <h4 id="name-change-certificate-syntax">
<a href="#appendix-B.1.1" class="section-number selfRef">B.1.1. </a><a href="#name-change-certificate-syntax" class="section-name selfRef">Change Certificate Syntax</a>
          </h4>
<p id="appendix-B.1.1-1">Alternatively, we can negotiate an extension that changes the syntax to Certificate to:<a href="#appendix-B.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-B.1.1-2">
<pre>
struct {
    CertificateType certificate_type;
    opaque certificate_request_context&lt;0..2^8-1&gt;;
    CertificateEntry certificate_list&lt;0..2^24-1&gt;;
} Certificate;
</pre><a href="#appendix-B.1.1-2" class="pilcrow">¶</a>
</div>
<p id="appendix-B.1.1-3">The negotiation can be:<a href="#appendix-B.1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-4.1">
              <p id="appendix-B.1.1-4.1.1">Client sends its accepted certificate types in ClientHello. Offering this new extension also signatures it is willing to accept the new message format. Unlike the existing extensions, an X.509-only client still sends the extension with just X509 in the list.<a href="#appendix-B.1.1-4.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.1.1-4.2">
              <p id="appendix-B.1.1-4.2.1">Server, if it implements the new syntax, acknowledges the syntax change with an empty extension in EncryptedExtensions. (It doesn't indicate its selection yet.)<a href="#appendix-B.1.1-4.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.1.1-4.3">
              <p id="appendix-B.1.1-4.3.1">If both of the above happen, Certificate's syntax has changed. Server indicates its selection with the <code>certificate_type</code> field<a href="#appendix-B.1.1-4.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.1.1-4.4">
              <p id="appendix-B.1.1-4.4.1">Server can also send this extension in CertificateRequest to offer non-X.509 certificate types<a href="#appendix-B.1.1-4.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="appendix-B.1.1-4.5">
              <p id="appendix-B.1.1-4.5.1">Client likewise indicates its selection with the <code>certificate_type</code> field.<a href="#appendix-B.1.1-4.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="appendix-B.1.1-5">This is a bit cleaner to parse, but the negotiation is more complex.<a href="#appendix-B.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="appendix-C">
      <h2 id="name-acknowledgements">
<a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-C-1">This document stands on the shoulders of giants and builds upon decades of work in TLS authentication and X.509. The authors would like to thank all those who have contributed over the history of these protocols.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">The authors additionally thank Bob Beck, Ryan Dickson, Nick Harper, Dennis Jackson, Ryan Sleevi, and Emily Stark for many valuable discussions and insights which led to this document. We wish to thank Mia Celeste in particular, whose implementation of an earlier draft revealed several pitfalls.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="change-log">
<section id="appendix-D">
      <h2 id="name-change-log">
<a href="#name-change-log" class="section-name selfRef">Change log</a>
      </h2>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="appendix-D-1.1">
          <p id="appendix-D-1.1.1"><strong>RFC Editor's Note:</strong> Please remove this section prior to publication of a
final version of this document.<a href="#appendix-D-1.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<div id="since-draft-davidben-tls-merkle-tree-certs-00">
<section id="appendix-D.1">
        <h3 id="name-since-draft-davidben-tls-me">
<a href="#name-since-draft-davidben-tls-me" class="section-name selfRef">Since draft-davidben-tls-merkle-tree-certs-00</a>
        </h3>
<ul class="normal">
<li class="normal" id="appendix-D.1-1.1">
            <p id="appendix-D.1-1.1.1">Simpify hashing by removing the internal padding to align with block size. #72<a href="#appendix-D.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.2">
            <p id="appendix-D.1-1.2.1">Avoid the temptation of floating points. #66<a href="#appendix-D.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.3">
            <p id="appendix-D.1-1.3.1">Require <code>lifetime</code> to be a multiple of <code>batch_duration</code>. #65<a href="#appendix-D.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.4">
            <p id="appendix-D.1-1.4.1">Rename window to validity window. #21<a href="#appendix-D.1-1.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.5">
            <p id="appendix-D.1-1.5.1">Split Assertion into Assertion and AbridgedAssertion. The latter is used in the Merkle Tree and HTTP interface. It replaces <code>subject_info</code> by a hash, to save space by not serving large post-quantum public keys. The original Assertion is used everywhere else, including BikeshedCertificate. #6<a href="#appendix-D.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.6">
            <p id="appendix-D.1-1.6.1">Add proper context to every node in the Merkle tree. #32<a href="#appendix-D.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.7">
            <p id="appendix-D.1-1.7.1">Clarify we use a single <code>CertificateEntry</code>. #11<a href="#appendix-D.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.8">
            <p id="appendix-D.1-1.8.1">Clarify we use POSIX time. #1<a href="#appendix-D.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.9">
            <p id="appendix-D.1-1.9.1">Miscellaneous changes.<a href="#appendix-D.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-D.1-1.10">
            <p id="appendix-D.1-1.10.1">Replace the negotiation mechanism with TLS Trust Anchor Identifiers.<a href="#appendix-D.1-1.10.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Benjamin</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:davidben@google.com" class="email">davidben@google.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Devon O'Brien</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:asymmetric@google.com" class="email">asymmetric@google.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bas Westerbaan</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bas@cloudflare.com" class="email">bas@cloudflare.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
